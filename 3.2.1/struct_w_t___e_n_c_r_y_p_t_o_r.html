<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: WT_ENCRYPTOR Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 3.2.1</span>
   </div>
   <div id="projectbrief"><!-- 3.2.1 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('struct_w_t___e_n_c_r_y_p_t_o_r.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="struct_w_t___e_n_c_r_y_p_t_o_r-members.html">List of all members</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">WT_ENCRYPTOR Struct Reference<div class="ingroups"><a class="el" href="group__wt__ext.html">WiredTiger Extension API</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The interface implemented by applications to provide custom encryption.  
 <a href="struct_w_t___e_n_c_r_y_p_t_o_r.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a0f0f363b689363d36ffce7fdf8a337ac"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a0f0f363b689363d36ffce7fdf8a337ac">encrypt</a> )(<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp)</td></tr>
<tr class="memdesc:a0f0f363b689363d36ffce7fdf8a337ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to encrypt a chunk of data.  <a href="#a0f0f363b689363d36ffce7fdf8a337ac">More...</a><br /></td></tr>
<tr class="separator:a0f0f363b689363d36ffce7fdf8a337ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abad5447ebeb99d06b9024df435cffc26"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#abad5447ebeb99d06b9024df435cffc26">decrypt</a> )(<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp)</td></tr>
<tr class="memdesc:abad5447ebeb99d06b9024df435cffc26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to decrypt a chunk of data.  <a href="#abad5447ebeb99d06b9024df435cffc26">More...</a><br /></td></tr>
<tr class="separator:abad5447ebeb99d06b9024df435cffc26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac965990f0d81b99fc10ec0b13b9df162"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#ac965990f0d81b99fc10ec0b13b9df162">sizing</a> )(<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, size_t *expansion_constantp)</td></tr>
<tr class="memdesc:ac965990f0d81b99fc10ec0b13b9df162"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to size a destination buffer for encryption.  <a href="#ac965990f0d81b99fc10ec0b13b9df162">More...</a><br /></td></tr>
<tr class="separator:ac965990f0d81b99fc10ec0b13b9df162"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a947e253ec628a29b62e4b6656eb7b92a"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a947e253ec628a29b62e4b6656eb7b92a">customize</a> )(<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <a class="el" href="group__wt__ext.html#ga6fa5797cf581d18dc843e07333a497e4">WT_CONFIG_ARG</a> *encrypt_config, <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> **customp)</td></tr>
<tr class="memdesc:a947e253ec628a29b62e4b6656eb7b92a"><td class="mdescLeft">&#160;</td><td class="mdescRight">If non-NULL, this callback is called to customize the encryptor.  <a href="#a947e253ec628a29b62e4b6656eb7b92a">More...</a><br /></td></tr>
<tr class="separator:a947e253ec628a29b62e4b6656eb7b92a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9337c89e540be05d207995c33bbe993"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#ad9337c89e540be05d207995c33bbe993">terminate</a> )(<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session)</td></tr>
<tr class="memdesc:ad9337c89e540be05d207995c33bbe993"><td class="mdescLeft">&#160;</td><td class="mdescRight">If non-NULL, a callback performed when the database is closed.  <a href="#ad9337c89e540be05d207995c33bbe993">More...</a><br /></td></tr>
<tr class="separator:ad9337c89e540be05d207995c33bbe993"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The interface implemented by applications to provide custom encryption. </p>
<p>Encryptors must implement the <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html" title="The interface implemented by applications to provide custom encryption. ">WT_ENCRYPTOR</a> interface: the <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a0f0f363b689363d36ffce7fdf8a337ac" title="Callback to encrypt a chunk of data. ">WT_ENCRYPTOR::encrypt</a>, <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#abad5447ebeb99d06b9024df435cffc26" title="Callback to decrypt a chunk of data. ">WT_ENCRYPTOR::decrypt</a> and <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#ac965990f0d81b99fc10ec0b13b9df162" title="Callback to size a destination buffer for encryption. ">WT_ENCRYPTOR::sizing</a> callbacks must be specified, <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a947e253ec628a29b62e4b6656eb7b92a" title="If non-NULL, this callback is called to customize the encryptor. ">WT_ENCRYPTOR::customize</a> and <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#ad9337c89e540be05d207995c33bbe993" title="If non-NULL, a callback performed when the database is closed. ">WT_ENCRYPTOR::terminate</a> are optional. To build your own encryptor, use one of the encryptors in <code>ext/encryptors</code> as a template: <code>ext/encryptors/nop_encrypt</code> is a simple encryptor that passes through data unchanged, and is a reasonable starting point; <code>ext/encryptors/rotn_encrypt</code> is an encryptor implementing a simple rotation cipher, it shows the use of <code>keyid</code>, <code>secretkey</code>, and implements the <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a947e253ec628a29b62e4b6656eb7b92a" title="If non-NULL, this callback is called to customize the encryptor. ">WT_ENCRYPTOR::customize</a> and <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#ad9337c89e540be05d207995c33bbe993" title="If non-NULL, a callback performed when the database is closed. ">WT_ENCRYPTOR::terminate</a> callbacks.</p>
<p>Applications register their implementation with WiredTiger by calling <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a59d203f4474780ca34bd3e07b8064949" title="Add an encryption function. ">WT_CONNECTION::add_encryptor</a>.</p>
<div class="fragment"><div class="line"><span class="comment">/* Local encryptor structure. */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> encryptor; <span class="comment">/* Must come first */</span></div><div class="line"></div><div class="line">    <a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html">WT_EXTENSION_API</a> *wt_api; <span class="comment">/* Extension API */</span></div><div class="line"></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nop_calls; <span class="comment">/* Count of calls */</span></div><div class="line"></div><div class="line">} NOP_ENCRYPTOR;</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * wiredtiger_extension_init --</span></div><div class="line"><span class="comment"> *     A simple shared library encryption example.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">int</span></div><div class="line"><a class="code" href="group__wt__ext.html#ga5ed14c916d5dcfe0e81aea9d9ccb7fe3">wiredtiger_extension_init</a>(<a class="code" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html">WT_CONNECTION</a> *connection, <a class="code" href="group__wt__ext.html#ga6fa5797cf581d18dc843e07333a497e4">WT_CONFIG_ARG</a> *config)</div><div class="line">{</div><div class="line">    NOP_ENCRYPTOR *nop_encryptor;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    (void)config; <span class="comment">/* Unused parameters */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ((nop_encryptor = calloc(1, <span class="keyword">sizeof</span>(NOP_ENCRYPTOR))) == NULL)</div><div class="line">        <span class="keywordflow">return</span> (errno);</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * Allocate a local encryptor structure, with a WT_ENCRYPTOR structure</span></div><div class="line"><span class="comment">     * as the first field, allowing us to treat references to either type of</span></div><div class="line"><span class="comment">     * structure as a reference to the other type.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * Heap memory (not static), because it can support multiple databases.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    nop_encryptor-&gt;encryptor.<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a0f0f363b689363d36ffce7fdf8a337ac">encrypt</a> = nop_encrypt;</div><div class="line">    nop_encryptor-&gt;encryptor.decrypt = nop_decrypt;</div><div class="line">    nop_encryptor-&gt;encryptor.sizing = nop_sizing;</div><div class="line">    nop_encryptor-&gt;encryptor.terminate = nop_terminate;</div><div class="line"></div><div class="line">    nop_encryptor-&gt;wt_api = connection-&gt;<a class="code" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a99df5b3a17564eb5b3e4ec076590133d">get_extension_api</a>(connection);</div><div class="line"></div><div class="line">    <span class="comment">/* Load the encryptor */</span></div><div class="line">    <span class="keywordflow">if</span> ((ret = connection-&gt;<a class="code" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a59d203f4474780ca34bd3e07b8064949">add_encryptor</a>(connection, <span class="stringliteral">&quot;nop&quot;</span>, (<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *)nop_encryptor, NULL)) ==</div><div class="line">      0)</div><div class="line">        <span class="keywordflow">return</span> (0);</div><div class="line"></div><div class="line">    free(nop_encryptor);</div><div class="line">    <span class="keywordflow">return</span> (ret);</div><div class="line">}</div></div><!-- fragment --><dl><dt><b>Examples: </b></dt><dd><a class="el" href="ex_encrypt_8c-example.html#_a1">ex_encrypt.c</a>, <a class="el" href="nop_encrypt_8c-example.html#_a0">nop_encrypt.c</a>, and <a class="el" href="rotn_encrypt_8c-example.html#_a0">rotn_encrypt.c</a>.</dd>
</dl></div><h2 class="groupheader">Member Data Documentation</h2>
<a id="a947e253ec628a29b62e4b6656eb7b92a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a947e253ec628a29b62e4b6656eb7b92a">&#9670;&nbsp;</a></span>customize</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_ENCRYPTOR::customize) (<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <a class="el" href="group__wt__ext.html#ga6fa5797cf581d18dc843e07333a497e4">WT_CONFIG_ARG</a> *encrypt_config, <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> **customp)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If non-NULL, this callback is called to customize the encryptor. </p>
<p>The customize function is called whenever a keyid is used for the first time with this encryptor, whether it be in the <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database. ">wiredtiger_open</a> call or the <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file. ">WT_SESSION::create</a> call. This gives the algorithm an opportunity to retrieve and save keys in a customized encryptor. If the callback returns a non-NULL encryptor, that instance is used instead of this one for any callbacks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">encrypt_config</td><td>the "encryption" portion of the configuration from the wiredtiger_open or <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file. ">WT_SESSION::create</a> call </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">customp</td><td>the new modified encryptor, or NULL. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero for success, non-zero to indicate an error. </dd></dl>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="ex_encrypt_8c-example.html#a13">ex_encrypt.c</a>.</dd>
</dl>
</div>
</div>
<a id="abad5447ebeb99d06b9024df435cffc26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abad5447ebeb99d06b9024df435cffc26">&#9670;&nbsp;</a></span>decrypt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_ENCRYPTOR::decrypt) (<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback to decrypt a chunk of data. </p>
<p><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#abad5447ebeb99d06b9024df435cffc26" title="Callback to decrypt a chunk of data. ">WT_ENCRYPTOR::decrypt</a> takes a source buffer and a destination buffer. The contents are switched from <code>encrypt:</code> the source buffer is the encrypted value, and the destination buffer is sized to be the original size. If the callback successfully decrypts the source buffer to the destination buffer, it returns 0. If an error occurs, it returns an errno or WiredTiger error code.</p>
<p>On entry, <code>src</code> will point to memory, with the length of the memory in <code>src_len</code>. After successful completion, the callback should return <code>0</code> and set <code>result_lenp</code> to the number of bytes required for the decrypted representation.</p>
<p>If the <code>dst</code> buffer is not big enough to hold the decrypted data, the callback should return an error.</p>
<p>This callback cannot be NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>the data to decrypt </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src_len</td><td>the length of the data to decrypt </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst</td><td>the destination buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst_len</td><td>the length of the destination buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result_lenp</td><td>the length of the decrypted data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero for success, non-zero to indicate an error.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * nop_decrypt --</span></div><div class="line"><span class="comment"> *     A simple decryption example that passes data through unchanged.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line">nop_decrypt(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, <span class="keywordtype">size_t</span> src_len,</div><div class="line">  uint8_t *dst, <span class="keywordtype">size_t</span> dst_len, <span class="keywordtype">size_t</span> *result_lenp)</div><div class="line">{</div><div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div><div class="line"></div><div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div><div class="line">    (void)src_len;</div><div class="line"></div><div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * The destination length is the number of unencrypted bytes we&#39;re expected to return.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    memcpy(dst, src, dst_len);</div><div class="line">    *result_lenp = dst_len;</div><div class="line">    <span class="keywordflow">return</span> (0);</div><div class="line">}</div></div><!-- fragment --><dl><dt><b>Examples: </b></dt><dd><a class="el" href="ex_encrypt_8c-example.html#a11">ex_encrypt.c</a>.</dd>
</dl>
</div>
</div>
<a id="a0f0f363b689363d36ffce7fdf8a337ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f0f363b689363d36ffce7fdf8a337ac">&#9670;&nbsp;</a></span>encrypt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_ENCRYPTOR::encrypt) (<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback to encrypt a chunk of data. </p>
<p><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a0f0f363b689363d36ffce7fdf8a337ac" title="Callback to encrypt a chunk of data. ">WT_ENCRYPTOR::encrypt</a> takes a source buffer and a destination buffer. The callback encrypts the source buffer (plain text) into the destination buffer.</p>
<p>On entry, <code>src</code> will point to memory, with the length of the memory in <code>src_len</code>. After successful completion, the callback should return <code>0</code> and set <code>result_lenp</code> to the number of bytes required for the encrypted representation.</p>
<p>On entry, <code>dst</code> points to the destination buffer with a length of <code>dst_len</code>. The destination buffer will be at least src_len plus the size returned by that WT_ENCRYPT::sizing.</p>
<p>This callback cannot be NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>the data to encrypt </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src_len</td><td>the length of the data to encrypt </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst</td><td>the destination buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst_len</td><td>the length of the destination buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result_lenp</td><td>the length of the encrypted data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero for success, non-zero to indicate an error.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * nop_encrypt --</span></div><div class="line"><span class="comment"> *     A simple encryption example that passes data through unchanged.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line">nop_encrypt(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, <span class="keywordtype">size_t</span> src_len,</div><div class="line">  uint8_t *dst, <span class="keywordtype">size_t</span> dst_len, <span class="keywordtype">size_t</span> *result_lenp)</div><div class="line">{</div><div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div><div class="line"></div><div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div><div class="line"></div><div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (dst_len &lt; src_len)</div><div class="line">        <span class="keywordflow">return</span> (nop_error(nop_encryptor, session, ENOMEM, <span class="stringliteral">&quot;encrypt buffer not big enough&quot;</span>));</div><div class="line"></div><div class="line">    memcpy(dst, src, src_len);</div><div class="line">    *result_lenp = src_len;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> (0);</div><div class="line">}</div></div><!-- fragment --><dl><dt><b>Examples: </b></dt><dd><a class="el" href="ex_encrypt_8c-example.html#a10">ex_encrypt.c</a>.</dd>
</dl>
</div>
</div>
<a id="ac965990f0d81b99fc10ec0b13b9df162"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac965990f0d81b99fc10ec0b13b9df162">&#9670;&nbsp;</a></span>sizing</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_ENCRYPTOR::sizing) (<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, size_t *expansion_constantp)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback to size a destination buffer for encryption. </p>
<p><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#ac965990f0d81b99fc10ec0b13b9df162" title="Callback to size a destination buffer for encryption. ">WT_ENCRYPTOR::sizing</a> is an callback that returns the number of additional bytes that is needed when encrypting a text buffer. This is always necessary, since encryptors typically generate encrypted text that is larger than the plain text input. Without such a call, WiredTiger would have no way to know the worst case for the encrypted buffer size. The WiredTiger encryption infrastructure assumes that buffer sizing is not dependent on the number of bytes of input, that there is a one to one relationship in number of bytes needed between input and output.</p>
<p>This callback cannot be NULL.</p>
<p>The callback should set <code>expansion_constantp</code> to the additional number of bytes needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">expansion_constantp</td><td>the additional number of bytes needed when encrypting. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero for success, non-zero to indicate an error.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * nop_sizing --</span></div><div class="line"><span class="comment"> *     A simple sizing example that tells wiredtiger that the encrypted buffer is always the same as</span></div><div class="line"><span class="comment"> *     the source buffer.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line">nop_sizing(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <span class="keywordtype">size_t</span> *expansion_constantp)</div><div class="line">{</div><div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div><div class="line"></div><div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div><div class="line"></div><div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div><div class="line"></div><div class="line">    *expansion_constantp = 0;</div><div class="line">    <span class="keywordflow">return</span> (0);</div><div class="line">}</div></div><!-- fragment --><dl><dt><b>Examples: </b></dt><dd><a class="el" href="ex_encrypt_8c-example.html#a12">ex_encrypt.c</a>.</dd>
</dl>
</div>
</div>
<a id="ad9337c89e540be05d207995c33bbe993"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9337c89e540be05d207995c33bbe993">&#9670;&nbsp;</a></span>terminate</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_ENCRYPTOR::terminate) (<a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If non-NULL, a callback performed when the database is closed. </p>
<p>It is called for each encryptor that was added using <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a59d203f4474780ca34bd3e07b8064949" title="Add an encryption function. ">WT_CONNECTION::add_encryptor</a> or returned by the <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#a947e253ec628a29b62e4b6656eb7b92a" title="If non-NULL, this callback is called to customize the encryptor. ">WT_ENCRYPTOR::customize</a> callback.</p>
<p>The <a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html#ad9337c89e540be05d207995c33bbe993" title="If non-NULL, a callback performed when the database is closed. ">WT_ENCRYPTOR::terminate</a> callback is intended to allow cleanup, the handle will not be subsequently accessed by WiredTiger.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * nop_terminate --</span></div><div class="line"><span class="comment"> *     WiredTiger no-op encryption termination.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line">nop_terminate(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session)</div><div class="line">{</div><div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div><div class="line"></div><div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div><div class="line"></div><div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Free the allocated memory. */</span></div><div class="line">    free(encryptor);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> (0);</div><div class="line">}</div></div><!-- fragment --><dl><dt><b>Examples: </b></dt><dd><a class="el" href="ex_encrypt_8c-example.html#a14">ex_encrypt.c</a>.</dd>
</dl>
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a></li>
    <li class="footer">Copyright (c) 2008-2019 MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
