<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: System buffer cache</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 11.1.0</span>
   </div>
   <div id="projectbrief"><!-- 11.1.0 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tune_system_buffer_cache.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">System buffer cache </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="tuning_system_buffer_cache_direct_io"></a>
Direct I/O</h1>
<p>WiredTiger optionally supports direct I/O. Configuring direct I/O may be useful for applications wanting to:</p><ul>
<li>minimize the operating system cache effects of I/O to and from WiredTiger's buffer cache,</li>
<li>avoid double-buffering of blocks in WiredTiger's cache and the operating system buffer cache, and</li>
<li>avoid stalling underlying solid-state drives by writing a large number of dirty blocks.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Using Direct I/O is almost never a good idea. Direct I/O implies a writing thread waits for the write to complete (which is a slower operation than writing into the system buffer cache), and configuring direct I/O is likely to decrease overall application performance. </dd>
<dd>
Direct I/O may not be available on all platforms.</dd></dl>
<p>Direct I/O can be separately configured for log files, data files, and blocks read using a (read-only) checkpoint cursor. Configuring direct I/O for data files will also configure direct I/O for all internal data files created by WiredTiger itself as well as application owned data files.</p>
<p>Direct I/O is configured using the <code>direct_io</code> configuration string to the <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database.">wiredtiger_open</a> function. An example of configuring direct I/O for data files:</p>
<div class="fragment"><div class="line">    error_check(<a class="code" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813">wiredtiger_open</a>(home, NULL, <span class="stringliteral">&quot;create,direct_io=[data]&quot;</span>, &amp;conn));</div>
</div><!-- fragment --><p> Systems require alignment for I/O buffers when direct I/O is configured, and using the wrong alignment can cause data loss or corruption. If direct I/O is configured, WiredTiger aligns I/O buffers to a default of 4KB; if different alignment is required by your system, the <code>buffer_alignment</code> configuration to the <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database.">wiredtiger_open</a> call should be set to the correct value. If buffer alignment is configured explicitly or as a result of configuring direct I/O, WiredTiger will silently increase file allocation and page sizes to be at least as large as the <code>buffer_alignment</code> value. In all cases, file allocation and page sizes must be a multiple of the <code>buffer_alignment</code> value.</p>
<p>On Windows, the <code>direct_io</code> configuration string controls whether the operating system cache is used to buffer reads, and writes to disk, i.e., FILE_FLAG_NO_BUFFERING. When direct I/O is off, Windows will use free RAM to cache access to files. This may had adverse effects because Windows may page out the WiredTiger buffer cache instead of its file cache. An additional configuration string, <code>write_through</code>, controls whether the disk is allowed to cache the writes. Enabling this flag increases write latency as the drive must ensure all writes are persisted to disk, but it ensures write durability. To get the equivalent of <code>O_DIRECT</code> on Windows, both <code>direct_io</code> and <code>write_through</code> must be set.</p>
<p>Some Linux systems do not support mixing <code>O_DIRECT</code> and memory mapping or normal I/O to the same file, and attempting to do so can result in data loss or corruption. For this reason:</p>
<ul>
<li>WiredTiger silently ignores the setting of the <code>mmap</code> configuration to the <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database.">wiredtiger_open</a> function in those cases, and will never memory map a file which is configured for direct I/O.</li>
<li>If <code>O_DIRECT</code> is configured for data files on Linux systems, any system utilities used to copy data files for the purposes of backup should also specify <code>O_DIRECT</code> when configuring their file access. A standard Linux system utility that supports <code>O_DIRECT</code> is the <code>dd</code> utility, when using the <code>iflag=direct</code> command-line option.</li>
</ul>
<h1><a class="anchor" id="tuning_system_buffer_cache_os_cache_dirty_max"></a>
os_cache_dirty_max</h1>
<p>As well as direct I/O, WiredTiger supports two additional configuration options related to the system buffer cache:</p>
<p>The first is <code>os_cache_dirty_max</code>, the maximum dirty bytes an object is allowed to have in the system buffer cache. Once this many bytes from an object are written into the system buffer cache, WiredTiger will attempt to schedule writes for all of the dirty blocks the object has in the system buffer cache. This configuration option allows applications to flush dirty blocks from the object, avoiding stalling any underlying drives when the object is subsequently flushed to disk as part of a durability operation.</p>
<p>An example of configuring <code>os_cache_dirty_max:</code> </p>
<div class="fragment"><div class="line">    error_check(session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb">create</a>(session, <span class="stringliteral">&quot;table:mytable&quot;</span>, <span class="stringliteral">&quot;os_cache_dirty_max=500MB&quot;</span>));</div>
</div><!-- fragment --><p> The <code>os_cache_dirty_max</code> configuration may not be used in combination with direct I/O.</p>
<p>The <code>os_cache_dirty_max</code> configuration is based on the non-standard Linux <code>sync_file_range</code> system call and will be ignored if set and that call is not available.</p>
<h1><a class="anchor" id="tuning_system_buffer_cache_os_cache_max"></a>
os_cache_max</h1>
<p>The second configuration option related to the system buffer cache is <code>os_cache_max</code>, the maximum bytes an object is allowed to have in the system buffer cache. Once this many bytes from an object are either read into or written from the system buffer cache, WiredTiger will attempt to evict all of the object's blocks from the buffer cache. This configuration option allows applications to evict blocks from the system buffer cache to limit double-buffering and system buffer cache overhead.</p>
<p>An example of configuring <code>os_cache_max:</code> </p>
<div class="fragment"><div class="line">    error_check(session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb">create</a>(session, <span class="stringliteral">&quot;table:mytable&quot;</span>, <span class="stringliteral">&quot;os_cache_max=1GB&quot;</span>));</div>
</div><!-- fragment --><p> The <code>os_cache_max</code> configuration may not be used in combination with direct I/O.</p>
<p>The <code>os_cache_max</code> configuration is based on the POSIX 1003.1 standard <code>posix_fadvise</code> system call and may not available on all platforms.</p>
<p>Configuring direct I/O, <code>os_cache_dirty_max</code> or <code>os_cache_max</code> all have the side effect of turning off memory-mapping of objects in WiredTiger. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="astruct_w_t___s_e_s_s_i_o_n_html_a358ca4141d59c345f401c58501276bbb"><div class="ttname"><a href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb">WT_SESSION::create</a></div><div class="ttdeci">int create(WT_SESSION *session, const char *name, const char *config)</div><div class="ttdoc">Create a table, column group, index or file.</div></div>
<div class="ttc" id="agroup__wt_html_gacbe8d118f978f5bfc8ccb4c77c9e8813"><div class="ttname"><a href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813">wiredtiger_open</a></div><div class="ttdeci">int wiredtiger_open(const char *home, WT_EVENT_HANDLER *event_handler, const char *config, WT_CONNECTION **connectionp)</div><div class="ttdoc">Open a connection to a database.</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="programming.html">Writing WiredTiger applications</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
