<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Schema</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 10.0.2</span>
   </div>
   <div id="projectbrief"><!-- 10.0.2 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('arch-schema.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Schema </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="arch_head"><table class="doxtable">
<tr>
<th rowspan="2" style="width:10%;"> <div><a href="arch-index.html"><img class="arch_thumbnail" src="wt_diagram.png" usemap="#wt_diagram_map" style="background-image: url(wt_diagram.png)"></a></div></th><th style="width:44%">Data Structures</th><th style="width:45%">Source Location</th></tr>
<map id="wt_diagram_map" name="wt_diagram_map">
<area shape="rect" id="id1" href="modules.html" title="modules.html" alt="" coords="248,128,283,144"/>
<area shape="rect" id="id2" href="arch-cache.html" title="arch-cache.html" alt="" coords="204,546,248,562"/>
<area shape="rect" id="id3" href="arch-cursor.html" title="arch-cursor.html" alt="" coords="234,224,280,240"/>
<area shape="rect" id="id4" href="arch-eviction.html" title="arch-eviction.html" alt="" coords="303,546,356,562"/>
<area shape="rect" id="id5" href="arch-logging.html" title="arch-logging.html" alt="" coords="388,650,443,666"/>
<area shape="rect" id="id6" href="arch-schema.html" title="arch-schema.html" alt="" coords="123,224,179,240"/>
<area shape="rect" id="id7" href="command_line.html" title="command_line.html" alt="" coords="374,23,430,39"/>
<area shape="rect" id="id8" href="arch-log-file.html" title="arch-log-file.html" alt="" coords="308,865,339,897"/>
<area shape="rect" id="id9" href="arch-metadata.html" title="arch-metadata.html" alt="" coords="25,328,89,344"/>
<area shape="rect" id="id10" href="arch-python.html" title="arch-python.html" alt="" coords="84,23,157,39"/>
<area shape="rect" id="id11" href="arch-snapshot.html" title="arch-snapshot.html" alt="" coords="297,441,371,457"/>
<area shape="rect" id="id12" href="arch-transaction.html" title="arch-transaction.html" alt="" coords="298,328,387,344"/>
<area shape="rect" id="id13" href="arch-hs.html" title="arch-hs.html" alt="" coords="93,642,140,674"/>
<area shape="rect" id="id14" href="arch-block.html" title="arch-block.html" alt="" coords="196,642,256,674"/>
<area shape="rect" id="id15" href="arch-dhandle.html" title="arch-dhandle.html" alt="" coords="144,320,205,352"/>
<area shape="rect" id="id16" href="arch-data-file.html" title="arch-data-file.html" alt="" coords="179,865,245,897"/>
<area shape="rect" id="id17" href="arch-row-column.html" title="arch-row-column.html" alt="" coords="117,433,205,465"/>
<area shape="rect" id="id18" href="arch-fs-os.html" title="arch-fs-os.html" alt="" coords="175,755,357,771"/>
</map>
<tr>
<td><code><code>WT_COLGROUP<br  />
WT_INDEX<br  />
WT_LSM_TREE<br  />
WT_TABLE</code></code></td><td><code><code>src/include/intpack_inline.h<br  />
src/include/packing_inline.h<br  />
src/include/schema.h<br  />
src/lsm/<br  />
src/packing/<br  />
src/schema/</code></code></td></tr>
</table>
</div><p> <b>Caution: the Architecture Guide is not updated in lockstep with the code base and is not necessarily correct or complete for any specific release.</b></p>
<p>A schema defines the format of the application data and how it will be stored by WiredTiger. While many tables have simple key/value pairs for records, WiredTiger also supports more complex data patterns. See <a class="el" href="schema.html">Schema, Columns, Column Groups, Indices and Projections</a> for more information.</p>
<h1><a class="anchor" id="schema_data_formats"></a>
Data Formats</h1>
<p>The format of keys and values is configured through <code>key_format</code> and <code>value_format</code> entries in <a class="el" href="config_strings.html">Configuration Strings</a>. WiredTiger supports simple or composite data formats for keys and values. See <a class="el" href="schema.html#schema_format_types">Format types</a> for the full list of supported data types.</p><ul>
<li>A simple format stores data in one type, for example <code>"key_format=i,value_format=S"</code>.</li>
<li>A composite format can store multiple data types as a single blob. The configuration string can be something like <code>"key_format=Si,value_format=ul"</code>. Cursors support encoding and decoding of these types of keys and values. See <a class="el" href="arch-cursor.html#arch_cursor_raw">Data translation</a> and <a class="el" href="schema.html#schema_cursor_formats">Cursor formats</a> for more details.</li>
</ul>
<p>Column store requires the key format to be defined as the record number <code>'r'</code> type. <a class="el" href="schema.html">Schema, Columns, Column Groups, Indices and Projections</a> has more information on key/value formats.</p>
<h1><a class="anchor" id="schema_files"></a>
Data Files</h1>
<p>Database schema defines how data files are organized in the database home folder:</p><ul>
<li>A row-oriented table keeps all the data in one file called <code>"&lt;table name&gt;.wt"</code>, where <code>"&lt;table name&gt;"</code> is the name that was passed as a part of the <code>name</code> parameter to <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a>.</li>
<li>A column-oriented table stores the data in multiple files. One for each column group. The filename will be as follows <code>"&lt;table name&gt;_&lt;colgroup name&gt;.wt"</code>. Where <code>"&lt;table name&gt;"</code> is the name that was specified as a part of the <code>name</code> parameter to <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a>. And <code>"&lt;colgroup name&gt;"</code> is the column group name defined in the <code>colgroups</code> entry during the definition of the table format. See this example of how column groups can be configured in WiredTiger <a class="el" href="ex_col_store_8c-example.html">ex_col_store.c</a>. <a class="el" href="arch-row-column.html">Row Store and Column Store</a> describes in more detail how row and column stores work.</li>
<li>Each table index is stored in a separate file <code>"&lt;table name&gt;_&lt;index name&gt;.wti"</code>. Where <code>"&lt;table name&gt;"</code> is the table name passed into <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a>. And <code>"&lt;index name&gt;"</code> is the index name defined during index creation. See <a class="el" href="schema.html#schema_indices">Indices</a> for more information on how to create a table index.</li>
<li>LSM trees are store on the file system in <code>"&lt;table name&gt;-&lt;chunk id&gt;.lsm"</code> files. Where <code>"&lt;table name&gt;"</code> is the name that was specified as a part of the <code>name</code> parameter to <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a>. <code>"&lt;chunk id&gt;"</code> is the chunk index managed by WiredTiger. More information on LSM trees can be found on this page <a class="el" href="lsm.html">Log-Structured Merge Trees</a>.</li>
<li>Bloom filters for LSM trees are stored in the files with the same name as the LSM tree chunk, but with a different extension: "&lt;table name&gt;-&lt;chunk id&gt;.bf". See <a class="el" href="lsm.html#lsm_bloom">Bloom filters</a> for more details.</li>
</ul>
<h1><a class="anchor" id="schema_integrity"></a>
Schema Integrity</h1>
<p>A user can create and manipulate database objects through the API listed on this page <a class="el" href="arch-schema.html#schema_api">Schema Manipulation</a>. There are several WiredTiger internal objects such as <a class="el" href="arch-metadata.html">Metadata</a>, <a class="el" href="arch-hs.html">History Store</a>, etc. The schema of those objects is locked and cannot be altered from outside of WiredTiger.</p>
<p>Schema operations cause an update to the metadata and are performed under the schema lock to avoid concurrent operations on the database schema. The following sequence of steps define a generic schema operation:</p>
<div class="image">
<img src="schema_generic.png" alt=""/>
</div>
 <p>Apart from the schema API, the schema lock is necessary for many other operations in WiredTiger including the following "heavy" database modifications:</p><ul>
<li>The schema lock wraps <code>checkpoint prepare</code> to avoid any tables being created or dropped during this phase. See <a class="el" href="arch-checkpoint.html">Checkpoint</a> for details.</li>
<li><code>Rollback to stable</code> operation acquires the schema lock to make sure no schema changes are done during this complex process. <a class="el" href="arch-rts.html">Rollback to Stable</a> has more information on the operation.</li>
<li>A <code>backup cursor</code> also holds the schema lock because it must guarantee a consistent view of what files and tables exist while it is being used, so it prevents any tables or files being created or dropped during that time. See <a class="el" href="backup.html">Backups</a> and <a class="el" href="arch-cursor.html#arch_cursor_backup">Backup cursors</a> for more information.</li>
</ul>
<p>All the schema operations listed below perform multi-step metadata modifications. Although they are <code>non-transactional</code>, the schema code tracks the metadata changes and performs the file and metadata operations in a specific order to provide recovery in the case of a crash.</p>
<h1><a class="anchor" id="schema_api"></a>
Schema Manipulation</h1>
<p>All schema manipulations are done in the context of <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html" title="All data operations are performed in the context of a WT_SESSION.">WT_SESSION</a>. All the methods below, except <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a> and <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#ac2bad195e24710d52d730fe3a7c1756a" title="Truncate a file, table, cursor range, or backup cursor.">WT_SESSION::truncate</a>, require exclusive access to the specified data source(s). If any cursors are open with the specified name(s) or a data source is otherwise in use, the call will fail and return EBUSY.</p>
<h2><a class="anchor" id="schema_create"></a>
Create</h2>
<p>The create schema operation is responsible for creating the underlying data objects on the filesystem and then creating required entries in the metadata. The API for this operation is <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a>.</p>
<h2><a class="anchor" id="schema_drop"></a>
Drop</h2>
<p><a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#adf785ef53c16d9dcc77e22cc04c87b70" title="Drop (delete) a table.">WT_SESSION::drop</a> operation drops the specified <code>uri</code>. The method will delete all related files and metadata entries. It is possible to keep the underlying files by specifying <code>"remove_files=false"</code> in the config string.</p>
<h2><a class="anchor" id="schema_rename"></a>
Rename</h2>
<p><a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a1d24b02549009f78b7c6463da0247614" title="Rename an object.">WT_SESSION::rename</a> schema operation renames the underlying data objects on the filesystem and updates the metadata accordingly.</p>
<h2><a class="anchor" id="schema_alter"></a>
Alter</h2>
<p><a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#ac6f0630cb70bb057aa4512f7888dc701" title="Alter a table.">WT_SESSION::alter</a> allows modification of some table settings after creation.</p>
<h2><a class="anchor" id="schema_truncate"></a>
Truncate</h2>
<p><a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#ac2bad195e24710d52d730fe3a7c1756a" title="Truncate a file, table, cursor range, or backup cursor.">WT_SESSION::truncate</a> truncates a file, table, cursor range, or backup cursor. If <code>start</code> and <code>stop</code> cursors are not specified all the data stored in the <code>uri</code> will be wiped out. When a range truncate is in progress, and another transaction inserts a key into that range, the behavior is not well defined. It is best to avoid this type of situations. See <a class="el" href="arch-btree.html#btree_truncate_operation">Truncate Operation</a> for more details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="arch-index.html">WiredTiger Architecture Guide</a></li><li class="navelem"><a class="el" href="arch-toc-data-org.html">Data Organization</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
