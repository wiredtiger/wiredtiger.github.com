<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Chunk cache</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 12.0.0</span>
   </div>
   <div id="projectbrief"><!-- 12.0.0 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('chunkcache.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Chunk cache </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The chunk cache is a feature designed to work in conjunction with <a class="el" href="arch-cloud-storage-extension.html">Storage Source</a>. These extensions would typically need to do IO over the network, which comes with performance and API usage costs. To ameliorate these, WiredTiger can be configured to cache in-use content from these storage sources on a disk.</p>
<p>Architecturally, the chunk cache sits between the block cache and the filesystem layer, caching data as it would appear "at rest". This implies the chunk cache stores data in its encrypted and compressed form, making it potentially more efficient. However, that also means it has no knowledge of the tree or page structure of the table, much like a file system wouldn't.</p>
<p>The chunk cache is read-only, and will only cache read-only content. In practice, this means any tiered objects that have been "flushed" during a checkpoint and can no longer be altered. Any data that could still be modified will reside in any of the block cache, the in-memory page cache, or a regular WiredTiger data file.</p>
<p>The cached "chunks" of files are a configurable size, but in general they should be large enough to mask the latency of fetching data over a network connection. These connections typically have a lot of bandwidth but high latency (when compared to a physically attached disk), so larger chunks will result in more efficient use of bandwidth. However, larger chunks can also result in less efficient utilization of cache space, as each chunk can only contain content from a single file (so the chunk containing the end of the file is still an entire chunk, even if only a single byte is needed for the file content).</p>
<p>The chunk cache resides on-disk and can generate a lot of IO, so should be kept on a different disk to WiredTiger's home directory. The cache can reuse content between WiredTiger restarts, but the content can be invalidated by upgrading WiredTiger or salvaging the database.</p>
<h1><a class="anchor" id="pinned"></a>
Pinned Content</h1>
<p>This functionality allows users to provide a list of tables that should remain persistently cached, ensuring faster data access times and reducing the need to fetch data from potentially much slower block storage. If a user wishes to cache a table in the chunk cache (such that the cached chunks belonging to these tables are non-evictable), the pinned configuration is required.</p>
<p><b>Note:</b> It is crucial to assess the memory implications of pinning large tables. Ensure the chunk cache has enough capacity to cache the pinned tables.</p>
<p>Example Configuration: </p><div class="fragment"><div class="line">chunk_cache=[enabled=<span class="keyword">true</span>,chunk_size=512KB,capacity=20GB,pinned=(<span class="stringliteral">&quot;table:chunkcache01&quot;</span>, <span class="stringliteral">&quot;table:chunkcache02&quot;</span>)]</div>
</div><!-- fragment --><p>In the configuration above, the pinned configuration array contains the names of tables to be pinned. In this example, the tables <b>chunkcache01</b> and <b>chunkcache02</b> are specified. By marking tables as pinned in the chunk cache, all chunks belonging to these tables (when read into chunk cache) remain in the cache. These chunks won't be evicted, regardless of how infrequently they might be accessed.</p>
<p><b>Note:</b> There could be circumstances when the pinned chunks can become unpinned (and evicted) for internal reasons.</p>
<p>This ensures that the pinned tables are always relatively cheap to access, minimizing the performance overhead of accessing these tables.</p>
<h1><a class="anchor" id="inserts"></a>
Newly inserted or modified content</h1>
<p>Newer content is more likely to be accessed again, so we insert freshly-flushed data into the chunk cache. This minimizes latency and reduces resource usage (disk bandwidth and API access). This saves the chunk cache from having to read freshly-flushed data back from the object store soon after it was put there. When a tiered object is flushed and before it is deleted locally, we make an ingest call and the new or modified table will be inserted into the chunk cache. This function will also check for outdated pinned content in the chunk cache, ensuring the older versions of the pinned content can be cleaned up by chunk cache's eviction process.</p>
<h1><a class="anchor" id="persistence"></a>
Persisted content</h1>
<p>The chunk cache could contain a considerable quantity of content. This content would typically be on-disk, meaning it can be persisted across WiredTiger restarts. Doing this saves the user time (due to reduced latency when accessing data from disk, compared to networked block storage) and resources (as these block storage accesses are often associated with an API usage cost).</p>
<p>This persistence is implemented with an additional WiredTiger internal file, named WiredTigerCC (where "CC" stands for "chunk cache"). This maintains the metadata necessary for WiredTiger to reuse chunk cache content on startup. This content could become stale, in which case a checksum failure is detected when we attempt to use it. This will result in a logged message and some data being re-fetched from block storage.</p>
<p>The persisted chunk cache content is invalidated when a salvage operation is run, a WiredTiger upgrade changes the metadata format, or when any of the chunk cache capacity, chunk size, or number of buckets is changed.</p>
<h1><a class="anchor" id="troubleshooting"></a>
Troubleshooting</h1>
<p>It is possible for content in the chunk cache to become outdated. WiredTiger's in-built data validation can detect this, and retry a read for incorrect data when it came from the chunk cache, but only once. There are statistics and verbose messaging around this, and it is not a concern to see this happen occasionally, particularly on startup and during crash recovery. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="programming.html">Writing WiredTiger applications</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
