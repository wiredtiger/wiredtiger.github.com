<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Tutorial: durability models</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 10.0.2</span>
   </div>
   <div id="projectbrief"><!-- 10.0.2 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('explain_durability.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial: durability models </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><em>Durability</em> refers to the property that a transaction, once committed, should be permanent and changes will never be lost. This can mean a number of things depending on context: for example, in-memory databases do not survive system crashes by definition, but commits to them are still durable in the sense that such commits are not rolled back or lost while the database is running. Traditionally data updates are durable when they have been stored on stable storage in a way that survives application and system crashes.</p>
<p>For WiredTiger, the situation is more complicated because WiredTiger is designed to be able to participate in application-level distributed transaction schemes, which implies the ability to roll back committed transactions when so instructed by the application. In this manual we use the following terminology:</p>
<ul>
<li>A transaction is <em>committed</em> when <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a712226eca5ade5bd123026c624468fa2" title="Commit the current transaction.">WT_SESSION::commit_transaction</a> has been called and has returned successfully.</li>
<li>A transaction is <em>durable</em> when all changes in it have been written to stable storage such that failures will not cause it to be lost.</li>
<li>A transaction is <em>stable</em> when it is durable, and furthermore cannot be rolled back by application-level transaction management activity.</li>
</ul>
<p>This page describes both the points at which transactions proceed from one of these states to the next, and also what kinds of failures transactions are protected from.</p>
<p>In general, there is a trade-off between write performance and durability guarantees: weaker guarantees require fewer round trips to storage devices.</p>
<h1><a class="anchor" id="explain_durability_in_memory"></a>
In-memory databases</h1>
<p>For in-memory databases, there is no disk-level durability and no protection against system or application crashes.</p>
<h1><a class="anchor" id="explain_durability_checkpoint"></a>
Checkpoint durability (without timestamps)</h1>
<p>For objects using checkpoint durability, the object is checkpointed periodically (a checkpoint is a complete self-consistent capture of the database state saved to stable storage) and transactions become durable with the completion of the next checkpoint after they commit. The interval between checkpoints bounds the possible data loss. Locally durable and stable are the same.</p>
<h1><a class="anchor" id="explain_durability_commit"></a>
Commit-level durability (without timestamps)</h1>
<p>Changes to objects with commit-level durability have log records written and flushed to disk before <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a712226eca5ade5bd123026c624468fa2" title="Commit the current transaction.">WT_SESSION::commit_transaction</a> returns. Such transactions are immediately durable and will survive both application and system failure. For objects using commit-level durability, transactions become durable when they are committed. Locally durable and stable are the same.</p>
<p>It is possible to skip the flush-to-disk; this makes transactions immediately durable against application crashes, but not against system crashes. Transactions then become durable against system crashes when the operating system writes them out. (If the operating system were to never write the log records, the object would revert to checkpoint durability.)</p>
<h1><a class="anchor" id="explain_durability_timestamp"></a>
Adding timestamps</h1>
<p>For databases using WiredTiger's timestamped data model, the durability model is extended with the notion of a <em>stable timestamp</em>. The stable timestamp is an application-managed point in time that governs when durable data becomes stable. That is, transactions commit at times after the stable timestamp, and become durable according to the underlying durability model, but can still be rolled back (and are thus considered <em>unstable</em>) until the stable timestamp is advanced past their commit timestamp.</p>
<p>Applications can roll back all unstable transactions by calling <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a93dbc74accb426582b3c5c2f69e04b28" title="Rollback tables to an earlier point in time, discarding all updates to checkpoint durable tables that...">WT_CONNECTION::rollback_to_stable</a> (or running recovery as part of database open).</p>
<p>Objects in a timestamp system are generally configured for checkpoint-level durability in which case the application's stable timestamp is saved with each checkpoint and used for crash recovery. Thus, to be stable a transaction must commit, the stable timestamp must be advanced past its durable timestamp, and then a checkpoint must complete. (Data written as part of checkpoints that complete between transaction commit and advancing the stable timestamp become durable but not stable.)</p>
<p>Objects in a timestamp system that are configured for commit-level durability operate as they do without timestamps, and timestamps are ignored for those objects. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="programming.html">Writing WiredTiger applications</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
