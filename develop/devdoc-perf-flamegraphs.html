<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: CPU Flame Graphs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 10.0.0</span>
   </div>
   <div id="projectbrief"><!-- 10.0.0 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('devdoc-perf-flamegraphs.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">CPU Flame Graphs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p><a href="http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html">FlameGraphs</a>, invented by <a href="http://www.brendangregg.com">Brendan Gregg</a>, help visually summarize on-CPU call stacks.</p>
<p>Below is an image of a FlameGraph generated from a 10-second run of the evict-btree-stress-multi wtperf job:</p>
<div class="image">
<img src="https://github.com/wiredtiger/wiredtiger/wiki/images/FlameGraph-evict-stress-multi-truncated.png"/>
</div>
<p>To see it in action, download the non-redacted interactive version <a href="https://github.com/wiredtiger/wiredtiger/wiki/images/FlameGraph-evict-stress-multi.svg">here</a> and open it in your web browser.</p>
<p>Quoting from <a href="http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html">Brendan Gregg's website</a>, here is how to interpret the output of the FlameGraph:</p>
<ul>
<li>Each box represents a function in the stack (a "stack frame").</li>
<li>The y-axis shows stack depth (number of frames on the stack). The top box shows the function that was on-CPU. Everything beneath that is ancestry. The function beneath a function is its parent, just like the stack traces shown earlier. (Some flame graph implementations prefer to invert the order and use an "icicle layout", so flames look upside down.)</li>
<li>The x-axis spans the sample population. It does not show the passing of time from left to right, as most graphs do. The left to right ordering has no meaning (it's sorted alphabetically to maximize frame merging).</li>
<li>The width of the box shows the total time it was on-CPU or part of an ancestry that was on-CPU (based on sample count). Functions with wide boxes may consume more CPU per execution than those with narrow boxes, or, they may simply be called more often. The call count is not shown (or known via sampling).</li>
</ul>
<p><b>Note:</b> If you generate a FlameGraph yourself and then open it in a browser, the image will be interactive, allowing you to hover over the functions to see their full names.</p>
<h1>Generating FlameGraphs</h1>
<p>To generate FlameGraphs, you first need to run perf and generate a perf.data file using the <code>perf record -g</code> command. <a class="el" href="devdoc-perf.html">Click here</a> for instructions explaining how to do this with WiredTiger. Don't forget the <code>-g</code> option: you need it in order to record the call stacks! </p><pre class="fragment"># Clone the FlameGraph repository
git clone https://github.com/brendangregg/FlameGraph
cd FlameGraph

# Place perf.data into the current directory, then run these commands.
# Run them on the same machine where you ran `perf record` so perf can
# resolve the symbols.
perf script | ./stackcollapse-perf.pl &gt; out.perf-folded
./flamegraph.pl out.perf-folded &gt; perf-kernel.svg
</pre><p>Then open the resultant <code>svg</code> file in your web browser.</p>
<p>Here is another FlameGraph for a full run of the <code>many-stable-stress.wtperf</code> job:</p>
<div class="image">
<img src="https://github.com/wiredtiger/wiredtiger/wiki/images/FlameGraph-many-tables-stress-truncated.png"/>
</div>
<p>Download the non-redacted interactive version <a href="https://github.com/wiredtiger/wiredtiger/wiki/images/FlameGraph-many-tables-stress.svg">here</a> and open it in your web browser.</p>
<p>If you see 'unknown' call stacks in your FlameGraph, this means that perf could not resolve the symbols. To fix this, install the versions of the libraries or the OS kernel with symbols included, link against those libraries and re-gather the <code>perf</code> output. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="devdoc-index.html">Developer Documentation</a></li>
    <li class="footer">Copyright (c) 2008-2020 MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
