<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Compaction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 12.0.0</span>
   </div>
   <div id="projectbrief"><!-- 12.0.0 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('compact.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Compaction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69" title="Compact a live row- or column-store btree.">WT_SESSION::compact</a> method can be used to compact data sources. Parallel activity can happen on the data sources while compaction is running but it might affect the efficiency of compaction. Furthermore, it is not possible to run compaction from multiple sessions on the same data source at the same time.</p>
<p><b>Note:</b> Because checkpoints named by the application are not discarded until explicitly removed or replaced, they may prevent <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69" title="Compact a live row- or column-store btree.">WT_SESSION::compact</a> from accomplishing anything.</p>
<h1><a class="anchor" id="foreground"></a>
Foreground compaction</h1>
<p>Foreground compaction is executed when a specific URI is given to the <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69" title="Compact a live row- or column-store btree.">WT_SESSION::compact</a> method. The call returns once compaction has been executed on the specified URI.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># Execute compaction on &quot;mytable&quot; with the default parameters.</span></div>
<div class="line"><span class="keywordtype">int</span> ret = session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69">compact</a>(session, <span class="stringliteral">&quot;table:mytable&quot;</span>, NULL);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Execute compaction on &quot;mytable&quot; if at least 20MB of free space can be theoretically reclaimed by compaction.</span></div>
<div class="line"><span class="preprocessor">int ret = session-&gt;compact(session, &quot;table:mytable&quot;, &quot;free_space_target=20MB&quot;);</span></div>
</div><!-- fragment --><h1><a class="anchor" id="background"></a>
Background compaction</h1>
<p>The "background" configuration item can be used to interact with background compaction when calling the <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69" title="Compact a live row- or column-store btree.">WT_SESSION::compact</a> method. The call immediately returns to the application but does not guarantee compaction will be enabled/disabled at the same time. A successful call simply means the request has been submitted to WiredTiger. For instance, if background compaction is disabled while it is compacting a table, compaction will be stopped as soon as it is safe to do so.</p>
<p>When background compaction is enabled, WiredTiger autonomously compacts the eligible files in the database. You can read more about eligible files on the following page: <a class="el" href="arch-compact.html">Compaction</a>.</p>
<p><b>Note:</b> When interacting with background compaction, NULL should be assigned to the argument corresponding to the URI.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor"># Enable background compaction with the default parameters.</span></div>
<div class="line"><span class="keywordtype">int</span> ret = session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69">compact</a>(session, NULL, <span class="stringliteral">&quot;background=true&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Enable background compaction and compact tables that have at least 20MB of free space that can be theoretically reclaimed by compaction.</span></div>
<div class="line"><span class="keywordtype">int</span> ret = session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69">compact</a>(session, NULL, <span class="stringliteral">&quot;background=true,free_space_target=20MB&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Enable background compaction and exclude the table &quot;mytable&quot;.</span></div>
<div class="line"><span class="keywordtype">int</span> ret = session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69">compact</a>(session, NULL, <span class="stringliteral">&quot;background=true,free_space_target=20MB,exclude=[\&quot;table:mytable.wt\&quot;]&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Disable background compaction.</span></div>
<div class="line"><span class="preprocessor">int ret = session-&gt;compact(session, NULL, &quot;background=false&quot;);</span></div>
</div><!-- fragment --><p>More information about compaction can be read here: <a class="el" href="arch-compact.html">Compaction</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="astruct_w_t___s_e_s_s_i_o_n_html_aafa7a12a4891a5bfdc98673a5b8f9c69"><div class="ttname"><a href="struct_w_t___s_e_s_s_i_o_n.html#aafa7a12a4891a5bfdc98673a5b8f9c69">WT_SESSION::compact</a></div><div class="ttdeci">int compact(WT_SESSION *session, const char *name, const char *config)</div><div class="ttdoc">Compact a live row- or column-store btree.</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="programming.html">Writing WiredTiger applications</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
