<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Metadata</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 11.3.1</span>
   </div>
   <div id="projectbrief"><!-- 11.3.1 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('arch-metadata.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Metadata </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="arch_head"><table class="doxtable">
<tr>
<th rowspan="2" style="width:10%;"> <div><a href="arch-index.html"><img class="arch_thumbnail" src="wt_diagram.png" usemap="#wt_diagram_map" style="background-image: url(wt_diagram.png)"></a></div></th><th style="width:44%">Data Structures</th><th style="width:45%">Source Location</th></tr>
<map id="wt_diagram_map" name="wt_diagram_map">
<area shape="rect" id="id1" href="modules.html" title="modules.html" alt="" coords="248,128,283,144"/>
<area shape="rect" id="id2" href="arch-cache.html" title="arch-cache.html" alt="" coords="204,546,248,562"/>
<area shape="rect" id="id3" href="arch-cursor.html" title="arch-cursor.html" alt="" coords="234,224,280,240"/>
<area shape="rect" id="id4" href="arch-eviction.html" title="arch-eviction.html" alt="" coords="303,546,356,562"/>
<area shape="rect" id="id5" href="arch-logging.html" title="arch-logging.html" alt="" coords="388,650,443,666"/>
<area shape="rect" id="id6" href="arch-schema.html" title="arch-schema.html" alt="" coords="123,224,179,240"/>
<area shape="rect" id="id7" href="command_line.html" title="command_line.html" alt="" coords="374,23,430,39"/>
<area shape="rect" id="id8" href="arch-log-file.html" title="arch-log-file.html" alt="" coords="308,865,339,897"/>
<area shape="rect" id="id9" href="arch-metadata.html" title="arch-metadata.html" alt="" coords="25,328,89,344"/>
<area shape="rect" id="id10" href="arch-python.html" title="arch-python.html" alt="" coords="84,23,157,39"/>
<area shape="rect" id="id11" href="arch-snapshot.html" title="arch-snapshot.html" alt="" coords="297,441,371,457"/>
<area shape="rect" id="id12" href="arch-transaction.html" title="arch-transaction.html" alt="" coords="298,328,387,344"/>
<area shape="rect" id="id13" href="arch-hs.html" title="arch-hs.html" alt="" coords="93,642,140,674"/>
<area shape="rect" id="id14" href="arch-block.html" title="arch-block.html" alt="" coords="196,642,256,674"/>
<area shape="rect" id="id15" href="arch-dhandle.html" title="arch-dhandle.html" alt="" coords="144,320,205,352"/>
<area shape="rect" id="id16" href="arch-data-file.html" title="arch-data-file.html" alt="" coords="179,865,245,897"/>
<area shape="rect" id="id17" href="arch-row-column.html" title="arch-row-column.html" alt="" coords="117,433,205,465"/>
<area shape="rect" id="id18" href="arch-fs-os.html" title="arch-fs-os.html" alt="" coords="175,755,357,771"/>
</map>
<tr>
<td><code><code></code></code></td><td><code><code>src/include/meta.h<br  />
src/meta/</code></code></td></tr>
</table>
</div><p> <b>Caution: the Architecture Guide is not updated in lockstep with the code base and is not necessarily correct or complete for any specific release.</b></p>
<p>Metadata in WiredTiger captures important information about the user's database. Metadata includes tracking essential information such as the files and tables present in the database, their associated configurations, as well as the latest checkpoints. The checkpoint information tells WiredTiger where to the find root page and all other parts of its tree when accessing the file.</p>
<p>The main metadata in WiredTiger is stored in the <code>WiredTiger.wt</code> file.</p>
<h1><a class="anchor" id="metadata_table"></a>
Metadata Table</h1>
<p>The keys in the <code>WiredTiger.wt</code> table are <code>uri</code> strings. For example, keys can include <code>"table:"</code> &amp; <code>"file:"</code> prefixed URIs, representing typical row-store WiredTiger tables. A non-exhaustive list of other example keys could also include <code>"index:"</code>, <code>"colgroups:"</code> and <code>"system:"</code> prefixed URIs, representing indexes, colgroups and special system values respectively.</p>
<p>The value corresponding to a given <code>uri</code> key in the metadata table is its associated configuration string. The configuration value itself is a list of key/value pairs in string form. The key/value pairs in the configuration strings are dependent on the type of <code>uri</code>. Thus, a metadata entry with a <code>uri</code> key beginning with <code>"table:"</code> will be a configuration string having entries such as <code>key_format</code> and <code>value_format</code> to describe the data encoding for the uri. A metadata key beginning with <code>"file:"</code> will have a different set of configuration entries associated with it. See <a class="el" href="config_strings.html">Configuration Strings</a> for more details about WiredTiger configuration strings.</p>
<h1><a class="anchor" id="metadata_checkpoint"></a>
Storing Checkpoint Metadata</h1>
<p>The latest checkpoint information for each btree in the system is stored in its metadata entry. The checkpoint metadata provides a known point in time from which WiredTiger can recover a btree's data after a restart. The checkpoint metadata for a given btree is stored within the configuration string under its associated <code>uri</code> key within the <code>WiredTiger.wt</code> table. Metadata configuration entries relevant to capturing a given btree's checkpoint state include:</p><ul>
<li><code>checkpoint:</code> The file's checkpoint entries, including their timestamp, transaction ID and write generation. Most importantly this information also tracks an encoded address cookie that describes the blocks that make up the checkpoint's data.</li>
<li><code>checkpoint_lsn:</code> The LSN of the last checkpoint.</li>
<li><code>checkpoint_backup_info:</code> Incremental backup information.</li>
</ul>
<h1><a class="anchor" id="metadata_turtle"></a>
Turtle file</h1>
<p>The metadata file <code>WiredTiger.wt</code> is a regular WiredTiger table itself. As such, the metadata table has a btree that also needs to be checkpointed. Since a new metadata entry needs to be created for each btree at the time of checkpointing, the metadata table is the last file to be checkpointed in the process. Checkpointing the metadata table last is important for capturing a consistent state of the btrees in the database at the time of the last checkpoint.</p>
<p>Due to this ordering, to successfully restore the checkpoint of the <code>WiredTiger.wt</code> file, WiredTiger captures the most recent checkpointing information of the metadata table in a separate special turtle file called <code>"WiredTiger.turtle"</code>. The turtle file itself is metadata for the WiredTiger metadata. Using the turtle file, WiredTiger can read the latest checkpoint information from the file when recovering the <code>WiredTiger.wt</code> table. Recovering the checkpoint of the <code>WiredTiger.wt</code> table in turn restores a consistent view of the checkpointing information for the other btrees in the system.</p>
<h1><a class="anchor" id="metadata_reading"></a>
Reading Metadata</h1>
<p>The contents of the metadata table is ASCII printable. The URIs and configuration values are all printable strings.</p>
<h2><a class="anchor" id="metadata_cursor"></a>
"metadata:" cursor</h2>
<p>To read the metadata, a caller can open a cursor, via <code><a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#afb5b4a69c2c5cafe411b2b04fdc1c75d" title="Open a new cursor on a data source or duplicate an existing cursor.">WT_SESSION::open_cursor</a></code>, with a <code>uri</code> equal to <code>"metadata:"</code>. Changes to the metadata cannot be written through the metadata cursor interface i.e. the metadata cursor is a read-only interface. Metadata is only changed/affected by API calls.</p>
<h2><a class="anchor" id="metadata_create_cursor"></a>
"metadata:create" cursor</h2>
<p>Additionally, to only read strings relating to creation configurations of the various <code>uri</code> keys present, a cursor can be opened with a <code>uri</code> equal to <code>"metadata:create"</code>. This type of cursor causes WiredTiger to strip out internal metadata when querying.</p>
<h2><a class="anchor" id="metadata_wt_util"></a>
Printing metadata with the wt utility</h2>
<p>Lastly the metadata in the <code>WiredTiger.wt</code> table can be dumped using the <code>wt</code> utility. A command option for specifically printing the metadata is <code>"wt list -v"</code>. This will display the various <code>uri</code> key strings with their associated configuration strings.</p>
<h1><a class="anchor" id="metadata_example"></a>
Example Metadata</h1>
<p>When table <code>A</code> is created (without named column groups), there are three entries in the metadata file, having these keys:</p><ul>
<li><code>"table:A"</code> </li>
<li><code>"colgroup:A"</code> </li>
<li><code>"file:A.wt"</code> </li>
</ul>
<p>For brevity, just the keys are shown; the values in the metadata btree are configuration strings that would show information about key/value format and other creation options, checkpoints associated with the table, etc.</p>
<p>The <code>"table:A"</code> represents the table interface that the API caller uses, and the associated data structure in memory for the table is <code>WT_TABLE</code>. If there were column groups or indices, there may be multiple btrees associated with the table, and listed in the metadata, but in this example there is just one.</p>
<p>Every table has one or more <code>"colgroup:"</code> entries. The column group entry's metadata references the <code>"file:"</code> entry that stores the btree, in this case it would reference <code>"file:A.wt"</code>. Column groups do not have an explicit data structure associated with them, but their associated btrees are referenced via an array in the <code>WT_TABLE</code>.</p>
<p>The <code>"file:"</code> entry represents the btree stored on disk, as well as parts cached in memory. The data structure implied by this entry is a <code>WT_BTREE</code>.</p>
<p>In summary, the relationship between prefixes and data structures is as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">URI prefix </th><th class="markdownTableHeadNone">struct type </th><th class="markdownTableHeadNone">has dhandle? </th><th class="markdownTableHeadNone">notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>table:</code>  </td><td class="markdownTableBodyNone">WT_TABLE </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone">the dhandle is cast to (WT_TABLE *)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>file:</code>  </td><td class="markdownTableBodyNone">WT_BTREE </td><td class="markdownTableBodyNone">yes </td><td class="markdownTableBodyNone">dhandle-&gt;handle is a (WT_BTREE *)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>colgroup:</code>  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">no </td><td class="markdownTableBodyNone">stored in an array in the WT_TABLE  </td></tr>
</table>
<p>See <a class="el" href="arch-dhandle.html">Data Handles</a> for more information about data handles (dhandles). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="arch-index.html">WiredTiger Architecture Guide</a></li><li class="navelem"><a class="el" href="arch-toc-data-org.html">Data Organization</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
