<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: nop_encrypt.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 12.0.0</span>
   </div>
   <div id="projectbrief"><!-- 12.0.0 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('nop_encrypt_8c-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nop_encrypt.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Shows the basic framework for building an encryptor as a plug in library.</p>
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> * Public Domain 2014-present MongoDB, Inc.</span></div>
<div class="line"><span class="comment"> * Public Domain 2008-2014 WiredTiger, Inc.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This is free and unencumbered software released into the public domain.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Anyone is free to copy, modify, publish, use, compile, sell, or</span></div>
<div class="line"><span class="comment"> * distribute this software, either in source code form or as a compiled</span></div>
<div class="line"><span class="comment"> * binary, for any purpose, commercial or non-commercial, and by any</span></div>
<div class="line"><span class="comment"> * means.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * In jurisdictions that recognize copyright laws, the author or authors</span></div>
<div class="line"><span class="comment"> * of this software dedicate any and all copyright interest in the</span></div>
<div class="line"><span class="comment"> * software to the public domain. We make this dedication for the benefit</span></div>
<div class="line"><span class="comment"> * of the public at large and to the detriment of our heirs and</span></div>
<div class="line"><span class="comment"> * successors. We intend this dedication to be an overt act of</span></div>
<div class="line"><span class="comment"> * relinquishment in perpetuity of all present and future rights to this</span></div>
<div class="line"><span class="comment"> * software under copyright law.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span></div>
<div class="line"><span class="comment"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</span></div>
<div class="line"><span class="comment"> * IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR</span></div>
<div class="line"><span class="comment"> * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</span></div>
<div class="line"><span class="comment"> * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span></div>
<div class="line"><span class="comment"> * OTHER DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;wiredtiger.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;wiredtiger_ext.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Local encryptor structure. */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <a name="_a0"></a><a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> encryptor; <span class="comment">/* Must come first */</span></div>
<div class="line"> </div>
<div class="line">    <a name="_a1"></a><a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html">WT_EXTENSION_API</a> *wt_api; <span class="comment">/* Extension API */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nop_calls; <span class="comment">/* Count of calls */</span></div>
<div class="line"> </div>
<div class="line">} NOP_ENCRYPTOR;</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * nop_error --</span></div>
<div class="line"><span class="comment"> *     Display an error from this module in a standard way.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">nop_error(NOP_ENCRYPTOR *encryptor, <a name="_a2"></a><a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <span class="keywordtype">int</span> err, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html">WT_EXTENSION_API</a> *wt_api;</div>
<div class="line"> </div>
<div class="line">    wt_api = encryptor-&gt;wt_api;</div>
<div class="line">    (void)wt_api-&gt;<a name="a3"></a><a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html#a6d58298e356dbf58ac854c3d1af99678">err_printf</a>(</div>
<div class="line">      wt_api, session, <span class="stringliteral">&quot;nop encryption: %s: %s&quot;</span>, msg, wt_api-&gt;<a name="a4"></a><a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html#a3fd4b5255e2f82139a846d66d67be565">strerror</a>(wt_api, NULL, err));</div>
<div class="line">    <span class="keywordflow">return</span> (err);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * nop_encrypt --</span></div>
<div class="line"><span class="comment"> *     A simple encryption example that passes data through unchanged.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">nop_encrypt(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, <span class="keywordtype">size_t</span> src_len,</div>
<div class="line">  uint8_t *dst, <span class="keywordtype">size_t</span> dst_len, <span class="keywordtype">size_t</span> *result_lenp)</div>
<div class="line">{</div>
<div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div>
<div class="line"> </div>
<div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div>
<div class="line"> </div>
<div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dst_len &lt; src_len)</div>
<div class="line">        <span class="keywordflow">return</span> (nop_error(nop_encryptor, session, ENOMEM, <span class="stringliteral">&quot;encrypt buffer not big enough&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    memcpy(dst, src, src_len);</div>
<div class="line">    *result_lenp = src_len;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * nop_decrypt --</span></div>
<div class="line"><span class="comment"> *     A simple decryption example that passes data through unchanged.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">nop_decrypt(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, <span class="keywordtype">size_t</span> src_len,</div>
<div class="line">  uint8_t *dst, <span class="keywordtype">size_t</span> dst_len, <span class="keywordtype">size_t</span> *result_lenp)</div>
<div class="line">{</div>
<div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div>
<div class="line"> </div>
<div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div>
<div class="line">    (void)src_len;</div>
<div class="line"> </div>
<div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * The destination length is the number of unencrypted bytes we&#39;re expected to return.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    memcpy(dst, src, dst_len);</div>
<div class="line">    *result_lenp = dst_len;</div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * nop_sizing --</span></div>
<div class="line"><span class="comment"> *     A simple sizing example that tells wiredtiger that the encrypted buffer is always the same as</span></div>
<div class="line"><span class="comment"> *     the source buffer.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">nop_sizing(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <span class="keywordtype">size_t</span> *expansion_constantp)</div>
<div class="line">{</div>
<div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div>
<div class="line"> </div>
<div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div>
<div class="line"> </div>
<div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div>
<div class="line"> </div>
<div class="line">    *expansion_constantp = 0;</div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * nop_customize --</span></div>
<div class="line"><span class="comment"> *     The customize function creates a customized encryptor.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">nop_customize(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <a class="code" href="group__wt__ext.html#ga6fa5797cf581d18dc843e07333a497e4">WT_CONFIG_ARG</a> *encrypt_config,</div>
<div class="line">  <a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> **customp)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * This is how keys are set: the extension is first loaded, and then for every distinct key used</span></div>
<div class="line"><span class="comment">     * a copy is made by calling the customize method. The original uncustomized WT_ENCRYPTOR is</span></div>
<div class="line"><span class="comment">     * ordinarily never used to encrypt or decrypt anything.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * The copy, with the key installed into it, should be returned to the caller via the customp</span></div>
<div class="line"><span class="comment">     * argument. If the customize method succeeds but sets *customp to NULL, the original encryptor</span></div>
<div class="line"><span class="comment">     * is used for that key.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * The customize method need not be provided, but in that case key configuration is not</span></div>
<div class="line"><span class="comment">     * performed, the original encryptor is used for all encryption, and it must have some other</span></div>
<div class="line"><span class="comment">     * means to get the key or keys it should use.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> NOP_ENCRYPTOR *orig;</div>
<div class="line">    NOP_ENCRYPTOR *<span class="keyword">new</span>;</div>
<div class="line">    <a name="_a5"></a><a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html">WT_CONFIG_ITEM</a> keyid, secretkey;</div>
<div class="line">    <a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html">WT_EXTENSION_API</a> *wt_api;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    orig = (<span class="keyword">const</span> NOP_ENCRYPTOR *)encryptor;</div>
<div class="line">    wt_api = orig-&gt;wt_api;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Allocate and initialize the new encryptor. */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((<span class="keyword">new</span> = calloc(1, <span class="keyword">sizeof</span>(*<span class="keyword">new</span>))) == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> (errno);</div>
<div class="line">    *<span class="keyword">new</span> = *orig;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get the keyid, if any. */</span></div>
<div class="line">    ret = wt_api-&gt;<a name="a6"></a><a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html#a0d3aae2ceac28f7b45188bcfa4306d45">config_get</a>(wt_api, session, encrypt_config, <span class="stringliteral">&quot;keyid&quot;</span>, &amp;keyid);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        keyid.<a name="a7"></a><a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get the explicit secret key, if any. */</span></div>
<div class="line">    ret = wt_api-&gt;<a class="code" href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html#a0d3aae2ceac28f7b45188bcfa4306d45">config_get</a>(wt_api, session, encrypt_config, <span class="stringliteral">&quot;secretkey&quot;</span>, &amp;secretkey);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        secretkey.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Providing both a keyid and a secretkey is an error. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (keyid.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> != 0 &amp;&amp; secretkey.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> != 0) {</div>
<div class="line">        ret = nop_error(</div>
<div class="line">          <span class="keyword">new</span>, NULL, EINVAL, <span class="stringliteral">&quot;nop_customize: keys specified with both keyid= and secretkey=&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> err;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Providing neither is also normally an error. Allow it here for the benefit of the test suite.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">if</span> (keyid.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> == 0 &amp;&amp; secretkey.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> == 0)</div>
<div class="line">        (void)keyid; <span class="comment">/* do nothing */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (keyid.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> != 0)</div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Here one would contact a key manager to get the key, then install it.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        (void)keyid.<a name="a8"></a><a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#aa0ce7d30a32600e16824966c638ee45f">str</a>; <span class="comment">/* do nothing; add code here */</span></div>
<div class="line"> </div>
<div class="line">    if (secretkey.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">len</a> != 0)</div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Here one would install the explicit secret key, probably after base64- or hex-decoding</span></div>
<div class="line"><span class="comment">         * it. If it&#39;s a passphrase rather than a key, one might hash it first. Other</span></div>
<div class="line"><span class="comment">         * transformations might be needed or wanted as well.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        (void)secretkey.<a class="code" href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#aa0ce7d30a32600e16824966c638ee45f">str</a>; <span class="comment">/* do nothing; add code here */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Return the new encryptor. */</span></div>
<div class="line">    *customp = (<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *)<span class="keyword">new</span>;</div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line"> </div>
<div class="line">err:</div>
<div class="line">    free(<span class="keyword">new</span>);</div>
<div class="line">    <span class="keywordflow">return</span> (ret);</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * nop_terminate --</span></div>
<div class="line"><span class="comment"> *     WiredTiger no-op encryption termination.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">nop_terminate(<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *encryptor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session)</div>
<div class="line">{</div>
<div class="line">    NOP_ENCRYPTOR *nop_encryptor = (NOP_ENCRYPTOR *)encryptor;</div>
<div class="line"> </div>
<div class="line">    (void)session; <span class="comment">/* Unused parameters */</span></div>
<div class="line"> </div>
<div class="line">    ++nop_encryptor-&gt;nop_calls; <span class="comment">/* Call count */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Free the allocated memory. */</span></div>
<div class="line">    free(encryptor);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * wiredtiger_extension_init --</span></div>
<div class="line"><span class="comment"> *     A simple shared library encryption example.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line"><a name="a9"></a><a class="code" href="group__wt__ext.html#ga5ed14c916d5dcfe0e81aea9d9ccb7fe3">wiredtiger_extension_init</a>(<a name="_a10"></a><a class="code" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html">WT_CONNECTION</a> *connection, <a class="code" href="group__wt__ext.html#ga6fa5797cf581d18dc843e07333a497e4">WT_CONFIG_ARG</a> *config)</div>
<div class="line">{</div>
<div class="line">    NOP_ENCRYPTOR *nop_encryptor;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    (void)config; <span class="comment">/* Unused parameters */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((nop_encryptor = calloc(1, <span class="keyword">sizeof</span>(NOP_ENCRYPTOR))) == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> (errno);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Allocate a local encryptor structure, with a WT_ENCRYPTOR structure as the first field,</span></div>
<div class="line"><span class="comment">     * allowing us to treat references to either type of structure as a reference to the other type.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * Heap memory (not static), because it can support multiple databases.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    nop_encryptor-&gt;encryptor.encrypt = nop_encrypt;</div>
<div class="line">    nop_encryptor-&gt;encryptor.decrypt = nop_decrypt;</div>
<div class="line">    nop_encryptor-&gt;encryptor.sizing = nop_sizing;</div>
<div class="line">    nop_encryptor-&gt;encryptor.customize = nop_customize;</div>
<div class="line">    nop_encryptor-&gt;encryptor.terminate = nop_terminate;</div>
<div class="line"> </div>
<div class="line">    nop_encryptor-&gt;wt_api = connection-&gt;<a name="a11"></a><a class="code" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a99df5b3a17564eb5b3e4ec076590133d">get_extension_api</a>(connection);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Load the encryptor */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((ret = connection-&gt;<a name="a12"></a><a class="code" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a59d203f4474780ca34bd3e07b8064949">add_encryptor</a>(connection, <span class="stringliteral">&quot;nop&quot;</span>, (<a class="code" href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a> *)nop_encryptor, NULL)) ==</div>
<div class="line">      0)</div>
<div class="line">        <span class="keywordflow">return</span> (0);</div>
<div class="line"> </div>
<div class="line">    free(nop_encryptor);</div>
<div class="line">    <span class="keywordflow">return</span> (ret);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astruct_w_t___e_x_t_e_n_s_i_o_n___a_p_i_html"><div class="ttname"><a href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html">WT_EXTENSION_API</a></div><div class="ttdoc">Table of WiredTiger extension methods.</div><div class="ttdef"><b>Definition:</b> wiredtiger_ext.h:58</div></div>
<div class="ttc" id="agroup__wt__ext_html_ga6fa5797cf581d18dc843e07333a497e4"><div class="ttname"><a href="group__wt__ext.html#ga6fa5797cf581d18dc843e07333a497e4">WT_CONFIG_ARG</a></div><div class="ttdeci">struct WT_CONFIG_ARG WT_CONFIG_ARG</div><div class="ttdef"><b>Definition:</b> wiredtiger.h.in:4376</div></div>
<div class="ttc" id="astruct_w_t___c_o_n_n_e_c_t_i_o_n_html_a99df5b3a17564eb5b3e4ec076590133d"><div class="ttname"><a href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a99df5b3a17564eb5b3e4ec076590133d">WT_CONNECTION::get_extension_api</a></div><div class="ttdeci">WT_EXTENSION_API * get_extension_api(WT_CONNECTION *wt_conn)</div><div class="ttdoc">Return a reference to the WiredTiger extension functions.</div></div>
<div class="ttc" id="astruct_w_t___c_o_n_f_i_g___i_t_e_m_html_aa0ce7d30a32600e16824966c638ee45f"><div class="ttname"><a href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#aa0ce7d30a32600e16824966c638ee45f">WT_CONFIG_ITEM::str</a></div><div class="ttdeci">const char * str</div><div class="ttdoc">The value of a configuration string.</div><div class="ttdef"><b>Definition:</b> wiredtiger.h.in:3896</div></div>
<div class="ttc" id="astruct_w_t___e_x_t_e_n_s_i_o_n___a_p_i_html_a3fd4b5255e2f82139a846d66d67be565"><div class="ttname"><a href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html#a3fd4b5255e2f82139a846d66d67be565">WT_EXTENSION_API::strerror</a></div><div class="ttdeci">const char *(* strerror)(WT_EXTENSION_API *, WT_SESSION *session, int error)</div><div class="ttdoc">Return information about an error as a string.</div><div class="ttdef"><b>Definition:</b> wiredtiger_ext.h:100</div></div>
<div class="ttc" id="astruct_w_t___e_n_c_r_y_p_t_o_r_html"><div class="ttname"><a href="struct_w_t___e_n_c_r_y_p_t_o_r.html">WT_ENCRYPTOR</a></div><div class="ttdoc">The interface implemented by applications to provide custom encryption.</div><div class="ttdef"><b>Definition:</b> wiredtiger.h.in:4719</div></div>
<div class="ttc" id="astruct_w_t___e_x_t_e_n_s_i_o_n___a_p_i_html_a0d3aae2ceac28f7b45188bcfa4306d45"><div class="ttname"><a href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html#a0d3aae2ceac28f7b45188bcfa4306d45">WT_EXTENSION_API::config_get</a></div><div class="ttdeci">int(* config_get)(WT_EXTENSION_API *wt_api, WT_SESSION *session, WT_CONFIG_ARG *config, const char *key, WT_CONFIG_ITEM *value)</div><div class="ttdoc">Return the value of a configuration key.</div><div class="ttdef"><b>Definition:</b> wiredtiger_ext.h:184</div></div>
<div class="ttc" id="agroup__wt__ext_html_ga5ed14c916d5dcfe0e81aea9d9ccb7fe3"><div class="ttname"><a href="group__wt__ext.html#ga5ed14c916d5dcfe0e81aea9d9ccb7fe3">wiredtiger_extension_init</a></div><div class="ttdeci">int wiredtiger_extension_init(WT_CONNECTION *connection, WT_CONFIG_ARG *config)</div><div class="ttdoc">Entry point to an extension, called when the extension is loaded.</div></div>
<div class="ttc" id="astruct_w_t___c_o_n_n_e_c_t_i_o_n_html"><div class="ttname"><a href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html">WT_CONNECTION</a></div><div class="ttdoc">A connection to a WiredTiger database.</div><div class="ttdef"><b>Definition:</b> wiredtiger.h.in:2063</div></div>
<div class="ttc" id="astruct_w_t___c_o_n_n_e_c_t_i_o_n_html_a59d203f4474780ca34bd3e07b8064949"><div class="ttname"><a href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a59d203f4474780ca34bd3e07b8064949">WT_CONNECTION::add_encryptor</a></div><div class="ttdeci">int add_encryptor(WT_CONNECTION *connection, const char *name, WT_ENCRYPTOR *encryptor, const char *config)</div><div class="ttdoc">Add an encryption function.</div></div>
<div class="ttc" id="astruct_w_t___c_o_n_f_i_g___i_t_e_m_html_adff0f6e5a3f781f0228015e8336f1a14"><div class="ttname"><a href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html#adff0f6e5a3f781f0228015e8336f1a14">WT_CONFIG_ITEM::len</a></div><div class="ttdeci">size_t len</div><div class="ttdoc">The number of bytes in the value referenced by str.</div><div class="ttdef"><b>Definition:</b> wiredtiger.h.in:3899</div></div>
<div class="ttc" id="astruct_w_t___e_x_t_e_n_s_i_o_n___a_p_i_html_a6d58298e356dbf58ac854c3d1af99678"><div class="ttname"><a href="struct_w_t___e_x_t_e_n_s_i_o_n___a_p_i.html#a6d58298e356dbf58ac854c3d1af99678">WT_EXTENSION_API::err_printf</a></div><div class="ttdeci">int(* err_printf)(WT_EXTENSION_API *wt_api, WT_SESSION *session, const char *fmt,...)</div><div class="ttdoc">Insert an error message into the WiredTiger error stream.</div><div class="ttdef"><b>Definition:</b> wiredtiger_ext.h:76</div></div>
<div class="ttc" id="astruct_w_t___s_e_s_s_i_o_n_html"><div class="ttname"><a href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a></div><div class="ttdoc">All data operations are performed in the context of a WT_SESSION.</div><div class="ttdef"><b>Definition:</b> wiredtiger.h.in:833</div></div>
<div class="ttc" id="astruct_w_t___c_o_n_f_i_g___i_t_e_m_html"><div class="ttname"><a href="struct_w_t___c_o_n_f_i_g___i_t_e_m.html">WT_CONFIG_ITEM</a></div><div class="ttdoc">The configuration information returned by the WiredTiger configuration parsing functions in the WT_EX...</div><div class="ttdef"><b>Definition:</b> wiredtiger.h.in:3885</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
