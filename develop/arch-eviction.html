<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Eviction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 10.0.2</span>
   </div>
   <div id="projectbrief"><!-- 10.0.2 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('arch-eviction.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Eviction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="arch_head"><table class="doxtable">
<tr>
<th rowspan="2" style="width:10%;"> <div><a href="arch-index.html"><img class="arch_thumbnail" src="wt_diagram.png" usemap="#wt_diagram_map" style="background-image: url(wt_diagram.png)"></a></div></th><th style="width:44%">Data Structures</th><th style="width:45%">Source Location</th></tr>
<map id="wt_diagram_map" name="wt_diagram_map">
<area shape="rect" id="id1" href="modules.html" title="modules.html" alt="" coords="248,128,283,144"/>
<area shape="rect" id="id2" href="arch-cache.html" title="arch-cache.html" alt="" coords="204,546,248,562"/>
<area shape="rect" id="id3" href="arch-cursor.html" title="arch-cursor.html" alt="" coords="234,224,280,240"/>
<area shape="rect" id="id4" href="arch-eviction.html" title="arch-eviction.html" alt="" coords="303,546,356,562"/>
<area shape="rect" id="id5" href="arch-logging.html" title="arch-logging.html" alt="" coords="388,650,443,666"/>
<area shape="rect" id="id6" href="arch-schema.html" title="arch-schema.html" alt="" coords="123,224,179,240"/>
<area shape="rect" id="id7" href="command_line.html" title="command_line.html" alt="" coords="374,23,430,39"/>
<area shape="rect" id="id8" href="arch-log-file.html" title="arch-log-file.html" alt="" coords="308,865,339,897"/>
<area shape="rect" id="id9" href="arch-metadata.html" title="arch-metadata.html" alt="" coords="25,328,89,344"/>
<area shape="rect" id="id10" href="arch-python.html" title="arch-python.html" alt="" coords="84,23,157,39"/>
<area shape="rect" id="id11" href="arch-snapshot.html" title="arch-snapshot.html" alt="" coords="297,441,371,457"/>
<area shape="rect" id="id12" href="arch-transaction.html" title="arch-transaction.html" alt="" coords="298,328,387,344"/>
<area shape="rect" id="id13" href="arch-hs.html" title="arch-hs.html" alt="" coords="93,642,140,674"/>
<area shape="rect" id="id14" href="arch-block.html" title="arch-block.html" alt="" coords="196,642,256,674"/>
<area shape="rect" id="id15" href="arch-dhandle.html" title="arch-dhandle.html" alt="" coords="144,320,205,352"/>
<area shape="rect" id="id16" href="arch-data-file.html" title="arch-data-file.html" alt="" coords="179,865,245,897"/>
<area shape="rect" id="id17" href="arch-row-column.html" title="arch-row-column.html" alt="" coords="117,433,205,465"/>
<area shape="rect" id="id18" href="arch-fs-os.html" title="arch-fs-os.html" alt="" coords="175,755,357,771"/>
</map>
<tr>
<td><code><code>WT_EVICT_ENTRY<br  />
WT_EVICT_QUEUE</code></code></td><td><code><code>src/include/cache.h<br  />
src/evict/</code></code></td></tr>
</table>
</div><p> <b>Caution: the Architecture Guide is not updated in lockstep with the code base and is not necessarily correct or complete for any specific release.</b></p>
<h1><a class="anchor" id="eviction_overall"></a>
Eviction</h1>
<p>The goal of eviction is to manage the <a class="el" href="arch-cache.html">Cache</a> and keep the cache in the margin set by the user. There is an upper limit for the total content and dirty content, whenever the cache goes above the target then eviction gets triggered to bring it down under the limits.</p>
<p>Eviction is managed using <code>WT_EVICT_QUEUE</code> structures, each of which contains a list of <code>WT_EVICT_ENTRY</code> structures.</p>
<p>Eviction is composed of one eviction server, zero or more eviction worker threads and three shared eviction_queues (two ordinary queues and one urgent queue). The eviction server's goal is to find the pages that can be evicted. It has to walk the pages in a tree, one tree after the other, and find evictable candidates. It makes fair judgments between the trees, remembers where it was in a tree, and proceeds to the next tree from there. It extracts all the pages that can be evicted, sorts them based on when they were accessed last, and takes one-third oldest of the evictable candidates. This simulates an approximate Least Recently Used (LRU) algorithm, as the references to these pages are then pushed into the eviction_queues. The whole goal is to remove the content which is older to be evicted and put it in the queue. A user can configure a minimum and a maximum number of eviction worker threads to be created through the connection configuration string. The goal of eviction worker threads is to pop the pages from the queues and evict them. Eviction worker threads wait for queues to be populated, working with the eviction server through a CV signaling mechanism. They then get to evicting the pages independently to the server, till the eviction queues are not empty. There is a mechanism where the number of worker threads can be scaled dynamically between the provided range. With this mechanism, the system automatically adjusts the available worker threads to an optimum number that gives a good eviction performance, while minimizing the overhead of having a lot of eviction threads.</p>
<p>It is possible to have just the eviction server and no worker threads. In such a case, the eviction server walks the tree to find pages to evict and evict these pages from the cache. Pages that are being marked for forced eviction go onto the urgent queue, and these pages take precedence over the pages from the ordinary eviction queues.</p>
<p>If there are other threads reading the content, the page cannot be evicted and the eviction server/worker threads check for that. Eviction has to lock and get exclusive access to the page so that after having checked if the page is evictable and starting to evict, a parallel reader doesn't start to access it.</p>
<h1><a class="anchor" id="clean_dirty_data"></a>
Clean vs dirty data</h1>
<ul>
<li>Clean refers to data in the cache that is identical to the version stored on disk.</li>
<li>Dirty refers to data in the cache that has been modified and needs to be reconciled with the data stored on the disk.</li>
</ul>
<h1><a class="anchor" id="clean_dirty_eviction"></a>
Clean vs dirty eviction</h1>
<ul>
<li>In the case of clean eviction, there is no dirty content on the page and it is directly removed from the memory. After that, the page remains solely on the disk unchanged.</li>
<li>In the case of dirty eviction, the dirty page goes through reconciliation. The obsolete content on the page is thrown out, the latest value goes to the data store and older values go to the history store.</li>
</ul>
<p>Sometimes the workload generates enough new data that eviction is unable to reduce the cache content and more new content is put into cache that can be removed by eviction. In such a case application threads are also forced to do the work of eviction workers threads, before they can read or write more data.</p>
<p>Eviction triggers and targets</p>
<p>WiredTiger provides several configuration options for tuning how pages are evicted from the cache.</p>
<p>WiredTiger eviction tuning options can be configured when first opening a database via <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database.">wiredtiger_open</a>, or changed after open with <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a579141678af06217b22869cbc604c6d4" title="Reconfigure a connection handle.">WT_CONNECTION::reconfigure</a>.</p>
<p>The <code>eviction_target</code> configuration value is the level at which WiredTiger attempts to keep the overall cache usage. Eviction worker threads are active when the cache contains at least this much content, expressed as a percentage of the total cache size.</p>
<p>The <code>eviction_trigger</code> configuration value is the level at which application threads start to perform the eviction.</p>
<p>The <code>eviction_dirty_target</code> and <code>eviction_dirty_trigger</code> operate in a similar way to the overall targets but only apply to dirty data in cache. In particular, application threads will be throttled if the percentage of dirty data reaches the <code>eviction_dirty_trigger</code>. Any page that has been modified since it was read from disk is considered dirty.</p>
<p>The <code>eviction_updates_target</code> perform eviction in worker threads when the cache contains at least this many bytes of updates</p>
<p>The <code>eviction_updates_trigger</code> trigger application threads to perform eviction when the cache contains at least this many bytes of updates.</p>
<p>It is worth noting that for all eviction target and trigger sizes, the target size must be lower than its trigger size counterpart. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="arch-index.html">WiredTiger Architecture Guide</a></li><li class="navelem"><a class="el" href="arch-toc-in-mem.html">In Memory Concepts</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
