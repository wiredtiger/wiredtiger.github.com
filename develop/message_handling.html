<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Message handling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 10.0.2</span>
   </div>
   <div id="projectbrief"><!-- 10.0.2 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('message_handling.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Message handling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="event_message_handling"></a>
Message handling using the WT_EVENT_HANDLER</h1>
<p>Specific error and other message handling can be configured by passing an implementation of <a class="el" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html" title="The interface implemented by applications to handle error, informational and progress messages.">WT_EVENT_HANDLER</a> to <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database.">wiredtiger_open</a> or <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#adad5965cd4a60f65b5ac01f7ca6d1fc0" title="Open a session.">WT_CONNECTION::open_session</a>.</p>
<p>For example, both informational and error messages might be passed to an application-specific logging function that added a timestamp and logged the message to a file, and error messages might additionally be output to the <code>stderr</code> file stream.</p>
<p>Additionally, applications will normally handle <code>WT_PANIC</code> as a special case. WiredTiger will always call the error handler callback with <code>WT_PANIC</code> in the case of a fatal error requiring database restart, however, WiredTiger cannot guarantee applications will see an application thread return <code>WT_PANIC</code> from a WiredTiger API call. For this reason, a correctly-written WiredTiger application will likely specify at least an error handler which will immediately exit or otherwise handle fatal errors. Note that no further WiredTiger calls are required after an error handler is called with <code>WT_PANIC</code> (and further calls will themselves immediately fail).</p>
<p>The following is a programmatic example of creating a custom event handler:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Create our own event handler structure to allow us to pass context through to event handler</span></div>
<div class="line"><span class="comment"> * callbacks. For this to work the WiredTiger event handler must appear first in our custom event</span></div>
<div class="line"><span class="comment"> * handler structure.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <a class="code" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html">WT_EVENT_HANDLER</a> h;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *app_id;</div>
<div class="line">} CUSTOM_EVENT_HANDLER;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * handle_wiredtiger_error --</span></div>
<div class="line"><span class="comment"> *     Function to handle error callbacks from WiredTiger.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">handle_wiredtiger_error(</div>
<div class="line">  <a class="code" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html">WT_EVENT_HANDLER</a> *handler, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <span class="keywordtype">int</span> error, <span class="keyword">const</span> <span class="keywordtype">char</span> *message)</div>
<div class="line">{</div>
<div class="line">    CUSTOM_EVENT_HANDLER *custom_handler;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Cast the handler back to our custom handler. */</span></div>
<div class="line">    custom_handler = (CUSTOM_EVENT_HANDLER *)handler;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Report the error on the console. */</span></div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;app_id %s, thread context %p, error %d, message %s\n&quot;</span>, custom_handler-&gt;app_id,</div>
<div class="line">      (<span class="keywordtype">void</span> *)session, error, message);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Exit if the database has a fatal error. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (error == <a class="code" href="group__wt.html#gaf4fc8744eb8fe4f1c6e125d0f2361992">WT_PANIC</a>)</div>
<div class="line">        exit(1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * handle_wiredtiger_message --</span></div>
<div class="line"><span class="comment"> *     Function to handle message callbacks from WiredTiger.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">handle_wiredtiger_message(<a class="code" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html">WT_EVENT_HANDLER</a> *handler, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, <span class="keyword">const</span> <span class="keywordtype">char</span> *message)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Cast the handler back to our custom handler. */</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;app id %s, thread context %p, message %s\n&quot;</span>, ((CUSTOM_EVENT_HANDLER *)handler)-&gt;app_id,</div>
<div class="line">      (<span class="keywordtype">void</span> *)session, message);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
</div><!-- fragment --><p> The following is a programmatic example of configuring the previously defined custom event handler:</p>
<div class="fragment"><div class="line">    CUSTOM_EVENT_HANDLER event_handler;</div>
<div class="line"> </div>
<div class="line">    event_handler.h.handle_error = handle_wiredtiger_error;</div>
<div class="line">    event_handler.h.handle_message = handle_wiredtiger_message;</div>
<div class="line">    <span class="comment">/* Set handlers to NULL to use the default handler. */</span></div>
<div class="line">    event_handler.h.handle_progress = NULL;</div>
<div class="line">    event_handler.h.handle_close = NULL;</div>
<div class="line">    event_handler.app_id = <span class="stringliteral">&quot;example_event_handler&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    error_check(<a class="code" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813">wiredtiger_open</a>(home, (<a class="code" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html">WT_EVENT_HANDLER</a> *)&amp;event_handler, <span class="stringliteral">&quot;create&quot;</span>, &amp;conn));</div>
</div><!-- fragment --> <h1><a class="anchor" id="message_handling_output"></a>
Output format of the WT_EVENT_HANDLER</h1>
<p>The messages generated by the <a class="el" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html" title="The interface implemented by applications to handle error, informational and progress messages.">WT_EVENT_HANDLER</a> can either be encoded in a flat string style format or JSON format.</p>
<h2><a class="anchor" id="message_handling_output_flat_string"></a>
Flat string format</h2>
<p>By default, all the messages going through the <a class="el" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html" title="The interface implemented by applications to handle error, informational and progress messages.">WT_EVENT_HANDLER</a> are generated as flat strings. The example below shows a message following the flat string format:</p>
<div class="fragment"><div class="line">[1637732238:116292][11175:0x123456789012], test_salvage.test_salvage.test_salvage_api(column-fix), file:test_salvage.a.wt, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a>.<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#ab3399430e474f7005bd5ea20e6ec7a8e">salvage</a>: [WT_VERB_SALVAGE_PROGRESS][INFO]: <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a>.<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#ab3399430e474f7005bd5ea20e6ec7a8e">salvage</a></div>
</div><!-- fragment --><h2><a class="anchor" id="message_handling_output_json"></a>
JSON format</h2>
<p>When configuring a WiredTiger connection through <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database.">wiredtiger_open</a> or <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a579141678af06217b22869cbc604c6d4" title="Reconfigure a connection handle.">WT_CONNECTION::reconfigure</a>, it is possible to configure the <a class="el" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html" title="The interface implemented by applications to handle error, informational and progress messages.">WT_EVENT_HANDLER</a> interface to produce <a href="http://www.json.org">JSON</a> encoded messages via the <code>json_output</code> configuration option. The <code>json_output</code> option takes a list message categories, where each category represents a method defined by the <a class="el" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html" title="The interface implemented by applications to handle error, informational and progress messages.">WT_EVENT_HANDLER</a> interface, i.e. 'message' represents the <a class="el" href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html#af08d42a14b46863708b2d453e99cd9c1" title="Callback to handle informational messages; by default, informational messages are written to the stdo...">WT_EVENT_HANDLER::handle_message</a> interface. For instance, to print all <b>messages</b> and <b>error</b> events in JSON format, the following setting needs to be added to the connection configuration:</p>
<div class="fragment"><div class="line">json_output=(message, error)</div>
</div><!-- fragment --><p>See <a class="el" href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813" title="Open a connection to a database.">wiredtiger_open</a> for the full list of options that can be assigned to <code>json_output</code>. Any event handler interface that is not specified under the <code>json_output</code> setting will default to using the flat string format.</p>
<p>The JSON output follows a specific schema with the following fields:</p>
<table class="doxtable">
<tr>
<th>Field</th><th>Description</th><th>Type </th></tr>
<tr>
<td>category</td><td>Message category defined by <code>WT_VERBOSE_CATEGORY</code> </td><td>String </td></tr>
<tr>
<td>category_id</td><td>Value representation of the message category</td><td>Integer </td></tr>
<tr>
<td>error_code</td><td>Value representation of the error</td><td>Integer </td></tr>
<tr>
<td>error_str</td><td>Error message</td><td>String </td></tr>
<tr>
<td>msg</td><td>Message</td><td>String </td></tr>
<tr>
<td>session_dhandle_name</td><td>Session dhandle name</td><td>String </td></tr>
<tr>
<td>session_err_prefix</td><td>Database error prefix defined in the <code>WT_CONNECTION_IMPL</code> structure</td><td>String </td></tr>
<tr>
<td>session_name</td><td>Session name</td><td>String </td></tr>
<tr>
<td>thread</td><td>Thread id</td><td>String </td></tr>
<tr>
<td>ts_sec</td><td>Time in seconds since Epoch, as reported by the system's real time clock</td><td>Integer </td></tr>
<tr>
<td>ts_usec</td><td>Time in microseconds since Epoch, as reported by the system's real time clock</td><td>Integer </td></tr>
<tr>
<td>verbose_level</td><td>Severity level associated with the message. See <a class="el" href="verbose_messaging.html">Verbose messaging</a> for more details</td><td>String </td></tr>
<tr>
<td>verbose_level_id</td><td>Value representation of the verbose level</td><td>Integer </td></tr>
</table>
<p>Note: The information present in a message depends on the available data at the time when the message is generated. In other words, all the fields defined above may not be present in a message as shown in the example below:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;category&quot;</span>:<span class="stringliteral">&quot;WT_VERB_SALVAGE_PROGRESS&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;category_id&quot;</span>:31,</div>
<div class="line">    <span class="stringliteral">&quot;msg&quot;</span>:<span class="stringliteral">&quot;WT_SESSION.salvage&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;session_dhandle_name&quot;</span>:<span class="stringliteral">&quot;file:test_salvage.a.wt&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;session_err_prefix&quot;</span>:<span class="stringliteral">&quot;test_salvage.test_salvage.test_salvage_api(column-fix)&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;session_name&quot;</span>:<span class="stringliteral">&quot;WT_SESSION.salvage&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;thread&quot;</span>:<span class="stringliteral">&quot;22604:0x123456789012&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;ts_sec&quot;</span>:1637730626,</div>
<div class="line">    <span class="stringliteral">&quot;ts_usec&quot;</span>:20915,</div>
<div class="line">    <span class="stringliteral">&quot;verbose_level&quot;</span>:<span class="stringliteral">&quot;INFO&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;verbose_level_id&quot;</span>:0,</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="astruct_w_t___e_v_e_n_t___h_a_n_d_l_e_r_html"><div class="ttname"><a href="struct_w_t___e_v_e_n_t___h_a_n_d_l_e_r.html">WT_EVENT_HANDLER</a></div><div class="ttdoc">The interface implemented by applications to handle error, informational and progress messages.</div><div class="ttdef"><b>Definition:</b> wiredtiger.in:3245</div></div>
<div class="ttc" id="astruct_w_t___s_e_s_s_i_o_n_html_ab3399430e474f7005bd5ea20e6ec7a8e"><div class="ttname"><a href="struct_w_t___s_e_s_s_i_o_n.html#ab3399430e474f7005bd5ea20e6ec7a8e">WT_SESSION::salvage</a></div><div class="ttdeci">int salvage(WT_SESSION *session, const char *name, const char *config)</div><div class="ttdoc">Salvage a table.</div></div>
<div class="ttc" id="agroup__wt_html_gacbe8d118f978f5bfc8ccb4c77c9e8813"><div class="ttname"><a href="group__wt.html#gacbe8d118f978f5bfc8ccb4c77c9e8813">wiredtiger_open</a></div><div class="ttdeci">int wiredtiger_open(const char *home, WT_EVENT_HANDLER *event_handler, const char *config, WT_CONNECTION **connectionp)</div><div class="ttdoc">Open a connection to a database.</div></div>
<div class="ttc" id="astruct_w_t___s_e_s_s_i_o_n_html"><div class="ttname"><a href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a></div><div class="ttdoc">All data operations are performed in the context of a WT_SESSION.</div><div class="ttdef"><b>Definition:</b> wiredtiger.in:751</div></div>
<div class="ttc" id="agroup__wt_html_gaf4fc8744eb8fe4f1c6e125d0f2361992"><div class="ttname"><a href="group__wt.html#gaf4fc8744eb8fe4f1c6e125d0f2361992">WT_PANIC</a></div><div class="ttdeci">#define WT_PANIC</div><div class="ttdoc">WiredTiger library panic.</div><div class="ttdef"><b>Definition:</b> wiredtiger.in:3833</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="programming.html">Writing WiredTiger applications</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
