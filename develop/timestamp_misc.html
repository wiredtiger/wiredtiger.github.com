<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Miscellaneous timestamp topics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="sorttable.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 10.0.2</span>
   </div>
   <div id="projectbrief"><!-- 10.0.2 --></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('timestamp_misc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Miscellaneous timestamp topics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="timestamp_read_roundup"></a>
Rounding up the read timestamp</h1>
<p>Applications setting timestamps for a transaction have to comply with the constraints based on the global timestamp state. In order to be compliant with the constraints, applications will need to query the global timestamp state, check their timestamps for compliance, and adjust timestamps if required. To reduce application burden, WiredTiger supports automatic timestamp rounding in some scenarios.</p>
<p>Applications can configure <code>roundup_timestamps=(read=true)</code> with the <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a7e26b16b26b5870498752322fad790bf" title="Start a transaction in this session.">WT_SESSION::begin_transaction</a> method. Configuring <code>roundup_timestamps=(read=true)</code> causes the read timestamp to be rounded up to the oldest timestamp. If the read timestamp is greater than the oldest timestamp no change will be made.</p>
<h1><a class="anchor" id="timestamp_misc_rts"></a>
Using rollback-to-stable with timestamps</h1>
<p>Applications can explicitly roll back the system to a specific stable timestamp by calling the <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a93dbc74accb426582b3c5c2f69e04b28" title="Rollback tables to an earlier point in time, discarding all updates to checkpoint durable tables that...">WT_CONNECTION::rollback_to_stable</a> method. Applications must first set the <code>stable</code> timestamp using <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#ad082439541b1b95d6aae6c15026fe512" title="Set a global transaction timestamp.">WT_CONNECTION::set_timestamp</a> and then call <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a93dbc74accb426582b3c5c2f69e04b28" title="Rollback tables to an earlier point in time, discarding all updates to checkpoint durable tables that...">WT_CONNECTION::rollback_to_stable</a>, which will discard all updates to checkpoint-durable tables that have commit timestamps more recent than the set stable timestamp.</p>
<p>Logged tables and updates made without an associated commit timestamp are unaffected.</p>
<p>The database must be quiescent during this process, and applications must close or reset all open cursors before calling the <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a93dbc74accb426582b3c5c2f69e04b28" title="Rollback tables to an earlier point in time, discarding all updates to checkpoint durable tables that...">WT_CONNECTION::rollback_to_stable</a> method.</p>
<h1><a class="anchor" id="timestamp_misc_diagnostic"></a>
Using diagnostic configurations to enforce timestamp usage</h1>
<p>The <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a> method supports additional checking of timestamp usage on a per-key or per-table basis. While these usage checks can decrease application performance, and applications may not choose to configure them in production settings, they are strongly recommended during development.</p>
<p>Setting the <code>write_timestamp_usage</code> configuration specifies how timestamps are expected to be used by the table:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">always </td><td class="markdownTableBodyNone">Require all updates to the table have a commit timestamp.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">never </td><td class="markdownTableBodyNone">Require no updates to the table have a commit timestamp.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ordered </td><td class="markdownTableBodyNone">Allow updates both with and without a commit timestamp, but once a commit timestamp is used when updating a key in the table, all future updates to the key require a commit timestamp as well; each update must have a commit timestamp after the previous update.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mixed_mode </td><td class="markdownTableBodyNone">Allow updates both with and without a commit timestamp; each update must have a commit timestamp after the previous update, or no timestamp at all.  </td></tr>
</table>
<p>The <code>write_timestamp_usage</code> configuration is expected to be used with the <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a358ca4141d59c345f401c58501276bbb" title="Create a table, column group, index or file.">WT_SESSION::create</a> method's <code>assert</code> configuration. The <code>"assert(read_timestamp)"</code> configuration requires timestamps always or never be used on reads in the table. The <code>"assert(write_timestamp)"</code> configuration requires update timestamps conform to the <code>write_timestamp_usage</code> setting. If WiredTiger detects a violation of the configured policy, an error message will be logged. Additionally, in diagnostic builds, the library will fail and drop core at the failing check.</p>
<dl class="section warning"><dt>Warning</dt><dd>These are best-effort checks by WiredTiger, and there are cases where application misbehavior will not be detected.</dd></dl>
<h1><a class="anchor" id="timestamp_misc_reset_snapshot"></a>
Resetting the snapshot</h1>
<p>Transactions that have not set <code>read_timestamp</code> can use <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a2117021276bad0e6f541e61a5459ec59" title="Reset the snapshot.">WT_SESSION::reset_snapshot</a> with timestamped tables as with non-timestamped tables, to get a new snapshot of the database to read from. See <a class="el" href="transactions_api.html#snapshot_reset">Resetting the session snapshot</a>. Transactions that have set <code>read_timestamp</code> can also call <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a2117021276bad0e6f541e61a5459ec59" title="Reset the snapshot.">WT_SESSION::reset_snapshot</a>, but it will have no effect.</p>
<h1><a class="anchor" id="timestamps_misc_in_memory"></a>
In-memory configurations and timestamps</h1>
<p>Timestamps are supported for in-memory databases, but must be configured as in ordinary databases, and the same APIs are used in both cases for historical reasons. By default, in-memory database objects behave like commit-level objects in ordinary databases, that is, timestamps are ignored. If logging is disabled for the object, using the <code>"log=(enabled=false)"</code> configuration, then the timestamps will not be ignored and will behave as with objects in ordinary databases where logging has been disabled. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Reference Guide</a></li><li class="navelem"><a class="el" href="programming.html">Writing WiredTiger applications</a></li>
    <li class="footer">Copyright (c) 2008-present MongoDB, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
